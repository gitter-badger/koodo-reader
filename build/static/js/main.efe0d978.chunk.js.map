{"version":3,"sources":["model/Highlighter.js","utils/otherUtil.js","redux/manager.redux.js","components/popupHighlight/popupHighlight.js","model/Note.js","components/popupNote/popupNote.js","model/Digest.js","redux/viewArea.redux.js","components/popupOption/popupOption.js","components/popupMenu/popupMenu.js","utils/recordLocation.js","utils/readerConfig.js","utils/styleConfig.js","redux/progressPanel.redux.js","components/viewPage/viewPage.js","utils/mouseEvent.js","components/viewArea/viewArea.js","components/background/background.js","components/themeList/themeList.js","components/fontSizeList/fontSizeList.js","components/dropdownList/dropdownList.js","redux/reader.redux.js","components/singleControl/singleControl.js","components/settingPanel/settingPanel.js","components/contentList/contentList.js","components/bookmarkList/boomarkList.js","utils/readingTime.js","components/navigationPanel/navigationPanel.js","model/Bookmark.js","redux/book.redux.js","components/operationPanel/operationPanel.js","components/messageBox/messageBox.js","components/progressPanel/progressPanel.js","containers/reader/reader.js","redux/sidebar.redux.js","utils/shelfUtil.js","components/about/about.js","components/sidebar/sidebar.js","components/searchBox/searchBox.js","model/Book.js","components/importLocal/importLocal.js","redux/chooseDrive.redux.js","components/header/header.js","utils/recordRecent.js","components/book/book.js","components/bookItem/bookItem.js","utils/sortUtil.js","components/bookList/booklist.js","components/bookmarkPage/bookmarkPage.js","components/noteList/noteList.js","components/digestList/digestList.js","utils/deleteUtil.js","components/deleteDialog/deleteDialog.js","components/editDialog/editDialog.js","components/addDialog/addDialog.js","components/sortDialog/sortDialog.js","components/loadingPage/loadingPage.js","components/chooseDrive/chooseDrive.js","components/emptyPage/emptyPage.js","containers/manager/manager.js","App.js","redux/settingPanel.redux.js","store.js","index.js"],"names":["Highlighter","key","bookKey","cfi","range","color","this","OtherUtil","list","keyWord","arr","i","length","match","push","arr1","arr2","_arr","flag","j","books","keyword","document","querySelector","value","bookNameArr","AuthorNameArr","forEach","item","name","toLowerCase","author","bookResults","fuzzyQuery","authorResults","results","MergeArray","console","log","sort","event","keyCode","target","sortCode","orderCode","json","localStorage","getItem","obj","JSON","parse","order","setItem","stringify","initState","epubs","covers","searchBooks","isSearch","isSort","isList","isSortDisplay","isMessage","message","handleSort","mode","type","payload","handleList","handleMessage","handleMessageBox","handleSortCode","code","handleFetchBooks","dispatch","localforage","err","bookArr","epubArr","epub","window","ePub","bookPath","content","restore","coverArr","index","a","coverUrl","then","url","PopupHighlight","handleReturn","props","changeMenu","handleClose","close","currentEpub","on","getHighlighter","iframe","getElementsByTagName","iDoc","contentDocument","parseInt","dataset","isNaN","Date","getTime","highlighter","highlightSelection","book","currentBook","getSelection","getRangeAt","cfiBase","renderer","currentChapter","EPUBJS","EpubCFI","generateCfiFromRange","charRange","rangy","saveCharacterRanges","body","serial","stopPropagation","highlighterArr","highlighters","closeMenu","empty","className","style","isChangeDirection","marginTop","onClick","handleHighlight","data-color","Component","actionCreator","connect","state","notes","reader","chapters","Note","chapter","text","date","year","getFullYear","month","getMonth","day","getDate","PopupNote","openMenu","sel","toString","trim","findIndex","spinePos","undefined","label","note","noteArr","placeholder","createNote","Digest","selection","handleOpenMenu","isOpenMenu","PopupOption","handleNote","handleCopy","execCommand","handleDigest","digest","digestArr","digests","handleOpenNote","isOpenNote","handleOpenHighlight","isOpenHighlight","viewArea","PopupMenu","setKey","setState","createHighlighter","config","ignoreWhiteSpace","elementTagName","elementProperties","onclick","isCollapsed","currentTarget","onElementCreate","element","applier","createClassApplier","addClassApplier","renderHighlighters","iWin","contentWindow","defaultView","serializeSelection","removeAllHighlights","classes","temp","restoreCharacterRanges","e","warn","deserializeSelection","rect","rangePosition","posY","posX","x","width","rightEdge","y","height","setAttribute","doc","setTimeout","addEventListener","bottom","handleSelection","RecordLocation","percentage","themeList","id","theme","fontSizeList","size","num","dropdownList","title","option","sideMenu","icon","driveList","emptyList","main","sub","readerConfig","fontFamily","fontWeight","fontSize","lineHeight","column","padding","disablePopup","progress","colors","getDefaultConfigObj","get","letterSpacing","join","StyleConfig","attr","currentStyle","getComputedStyle","script","scriptEl","getElementById","createElement","defer","appendChild","css","textContent","head","ReaderConfig","getDefaultCss","split","inner","outer","outerDoc","innerDoc","getUserStyle","addCss","getUserScript","resetConfig","applyCss","addDefaultCss","applyScript","section","locations","handlePercentage","ViewPage","isSingle","removeEventListener","copyTextHack","page","init","renderTo","isFirefox","navigator","userAgent","indexOf","lock","arrowKeys","preventDefault","prevPage","nextPage","mouseFirefox","detail","mouseChrome","wheelDelta","copyText","which","ctrlKey","MouseEvent","getCurrentLocationCfi","percentageFromCfi","recordCfi","gotoCfi","getCfi","clipboardData","setData","forceSingle","progressPanel","ViewArea","closeNoteCard","Background","display","xmlns","viewBox","x1","x2","y2","gradientUnits","offset","stopColor","stopOpacity","transform","ThemeList","currentBackgroundIndex","set","map","handleChangeColor","backgroundColor","settingPanel","FontSizeList","currentFontSizeIndex","handleFontSize","DropdownList","currentFontFamilyIndex","currentLineHeightIndex","parseFloat","currentPaddingIndex","children","currentFontIndex","currentFontWeightIndex","currentWordSpacingIndex","onChange","handleView","bookmarks","handleNotes","handleBookmarks","handleDigests","handleFetchNotes","handleFetchBookmarks","handleFetchDigests","handleFetchHighlighters","SingleControl","handleClick","handleSingle","opacity","SettingPanel","manager","ContentList","handleJump","bind","getToc","href","getAttribute","goto","isSubContentList","subitems","BookmarkList","setInterval","filter","Math","floor","cursor","renderBookmarkList","nextProps","prevState","ReadingTime","time","NavigationPanel","isContentShow","cover","searchList","timer","clearInterval","setTime","src","alt","arthur","Bookmark","isOpenEditDialog","isOpenDeleteDialog","isOpenAddDialog","isReading","isRedirect","handleEditDialog","handleDeleteDialog","handleAddDialog","handleReadingState","handleReadingBook","handleReadingEpub","OperationPanel","isFullScreen","isBookmark","handleExitFullScreen","handleFullScreen","de","documentElement","requestFullscreen","mozRequestFullScreen","webkitRequestFullscreen","msRequestFullscreen","exitFullscreen","msExitFullscreen","mozCancelFullScreen","webkitExitFullscreen","firstVisibleNode","findFirstVisible","bookmark","bookmarkArr","handleExit","handleAddBookmark","handleScreen","MessageBox","ProgressPanel","onProgressChange","location","cfiFromPercentage","onProgressInput","displayPercentage","previourChapter","currentSection","displayChapter","nextChapter","handleFetchLocations","round","defaultValue","max","min","step","onMouseUp","generate","result","handleLocations","Reader","handleEnter","position","isOpenSettingPanel","isOpenInfoPanel","isOpenOperationPanel","isOpenProgressPanel","handleLeave","handleFetchPercentage","handleFetchChapters","onMouseEnter","onMouseLeave","handleChapters","shelfIndex","defaultShelf","新建书架","工作学习","生活百科","休闲娱乐","ShelfUtil","shelfTitle","unshift","splice","About","handleGithub","isGithub","handleContact","isContact","handleDonate","isDonate","isNew","rel","Sidebar","handleSidebar","isCollapse","handleMode","handleShelfIndex","handleShelf","handleShelfItem","shelfList","Object","keys","getShelf","renderShelfList","sidebar","Header","UNSAFE_componentWillReceiveProps","handleMouse","MouseSearch","handleSearchBooks","handleSearch","handleKey","KeySearch","handleCancel","onKeyDown","Book","description","md5","ImportLocal","handleAddBook","doIncrementalTest","file","blobSlice","File","prototype","slice","mozSlice","webkitSlice","chunks","ceil","currentChunk","spark","SparkMD5","fileReader","FileReader","loadNext","start","end","readAsBinaryString","call","onload","appendBinary","handleBook","isRepeat","readAsArrayBuffer","getMetadata","metadata","bookTitle","creator","BookModel","handleChange","files","accept","multiple","isChoose","handleChoose","handleSortBooks","handleSortDisplay","handleOnlyLocal","isOnlyLocal","marginLeft","RecordRecent","handleDeleteBook","handleEditBook","handleAddShelf","handleConfig","isOpenConfig","isDeleteDialog","handleOpenBook","RecentBooks","setRecent","bookCover","getRecent","getBookName","nameArr","getBookIndex","oldNameArr","indexArr","SortUtil","reverse","BookList","handleRecent","items","recentArr","itemArr","currentShelfTitle","currentShelfList","sortBooks","renderBookList","BookmarkPage","handleRedirect","handlePopup","renderIndex","bookKeyArr","coverObj","bookmarkObj","renderBookmarkPageItem","isShowMore","renderBookmarklistItem","NoteList","handleBookName","currentDate","currentIndex","dateArr","noteObj","isCurrent","DigestList","digestObj","DeleteUtil","deleteIndex","DeleteDialog","handleComfirm","deleteBook","isCheck","deleteBookmarks","deleteNotes","deleteDigests","deleteHighlighters","handleCheck","editDialog","nameBox","authorBox","AddDialog","setShelf","removeAttribute","disabled","SortDialog","setSortCode","handleOrder","LoadingPage","renderLoadingPage","ChooseDrive","EmptyPage","visibility","Manager","totalBooks","handleFetchSortCode","getSortCode","handleFetchList","chooseDrive","App","wordSpacing","rootReducer","combineReducers","action","background","dialogLocation","store","createStore","compose","applyMiddleware","thunk","devToolsExtension","f","ReactDOM","render"],"mappings":"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","file":"static/js/main.efe0d978.chunk.js","sourcesContent":["class Highlighter {\r\n  constructor(key, bookKey, cfi, range, color) {\r\n    this.key = key;\r\n    this.bookKey = bookKey;\r\n\r\n    this.cfi = cfi;\r\n    this.color = color;\r\n    this.range = range; // Rangy.js产生的将Range对象序列化后的字符串\r\n  }\r\n}\r\n\r\nexport default Highlighter;\r\n","// import localforage from \"localforage\";\r\n// import BookModel from \"../model/Book\";\r\nclass OtherUtil {\r\n  static fuzzyQuery(list, keyWord) {\r\n    var arr = [];\r\n    for (var i = 0; i < list.length; i++) {\r\n      if (list[i].match(keyWord) != null) {\r\n        arr.push(i);\r\n      }\r\n    }\r\n    return arr;\r\n  }\r\n  static MergeArray(arr1, arr2) {\r\n    var _arr = [];\r\n    for (let i = 0; i < arr1.length; i++) {\r\n      _arr.push(arr1[i]);\r\n    }\r\n    for (let i = 0; i < arr2.length; i++) {\r\n      var flag = true;\r\n      for (let j = 0; j < arr1.length; j++) {\r\n        if (arr2[i] === arr1[j]) {\r\n          flag = false;\r\n          break;\r\n        }\r\n      }\r\n      if (flag) {\r\n        _arr.push(arr2[i]);\r\n      }\r\n    }\r\n    return _arr;\r\n  }\r\n  static MouseSearch(books) {\r\n    let keyword = document.querySelector(\".header-search-box\").value;\r\n    let bookNameArr = [];\r\n    let AuthorNameArr = [];\r\n    books.forEach(item => {\r\n      bookNameArr.push(item.name.toLowerCase());\r\n      AuthorNameArr.push(item.author.toLowerCase());\r\n    });\r\n    let bookResults = this.fuzzyQuery(bookNameArr, keyword);\r\n    let authorResults = this.fuzzyQuery(AuthorNameArr, keyword);\r\n    let results = this.MergeArray(bookResults, authorResults);\r\n    console.log(results.sort());\r\n    return results;\r\n  }\r\n  static KeySearch(event, books) {\r\n    if (event && event.keyCode === 13) {\r\n      let bookNameArr = [];\r\n      let AuthorNameArr = [];\r\n      books.forEach(item => {\r\n        bookNameArr.push(item.name.toLowerCase());\r\n        AuthorNameArr.push(item.author.toLowerCase());\r\n      });\r\n      let bookResults = this.fuzzyQuery(bookNameArr, event.target.value);\r\n      let authorResults = this.fuzzyQuery(AuthorNameArr, event.target.value);\r\n      let results = this.MergeArray(bookResults, authorResults);\r\n      console.log(results.sort());\r\n\r\n      return results;\r\n    }\r\n  }\r\n  static setSortCode(sortCode, orderCode) {\r\n    let json = localStorage.getItem(\"sortCode\");\r\n    let obj = JSON.parse(json) || { sort: 2, order: 2 };\r\n    obj.sort = sortCode;\r\n    obj.order = orderCode;\r\n    localStorage.setItem(\"sortCode\", JSON.stringify(obj));\r\n  }\r\n\r\n  static getSortCode() {\r\n    let json = localStorage.getItem(\"sordCode\");\r\n    let obj = JSON.parse(json) || { sort: 2, order: 2 };\r\n    return obj || null;\r\n  }\r\n}\r\n\r\nexport default OtherUtil;\r\n","import localforage from \"localforage\";\r\nimport OtherUtil from \"../utils/otherUtil\";\r\nconst initState = {\r\n  books: null,\r\n  epubs: null,\r\n  covers: null,\r\n  searchBooks: [],\r\n  isSearch: false,\r\n  isSort: true,\r\n  isList: \"card\",\r\n  isSortDisplay: false,\r\n  sortCode: { sort: 2, order: 2 },\r\n  isMessage: false,\r\n  message: \"添加成功\"\r\n};\r\nexport function manager(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"HANDLE_BOOKS\":\r\n      return {\r\n        ...state,\r\n        books: action.payload\r\n      };\r\n    case \"HANDLE_SEARCH_BOOKS\":\r\n      return {\r\n        ...state,\r\n        searchBooks: action.payload\r\n      };\r\n    case \"HANDLE_SEARCH\":\r\n      return {\r\n        ...state,\r\n        isSearch: action.payload\r\n      };\r\n    case \"HANDLE_SORT\":\r\n      return {\r\n        ...state,\r\n        isSort: action.payload\r\n      };\r\n    case \"HANDLE_LIST\":\r\n      return {\r\n        ...state,\r\n        isList: action.payload\r\n      };\r\n    case \"HANDLE_SORT_DISPLAY\":\r\n      return {\r\n        ...state,\r\n        isSortDisplay: action.payload\r\n      };\r\n    case \"HANDLE_MESSAGE\":\r\n      return {\r\n        ...state,\r\n        message: action.payload\r\n      };\r\n    case \"HANDLE_MESSAGE_BOX\":\r\n      return {\r\n        ...state,\r\n        isMessage: action.payload\r\n      };\r\n    case \"HANDLE_SORT_CODE\":\r\n      return {\r\n        ...state,\r\n        sortCode: { sort: action.payload.sort, order: action.payload.order }\r\n      };\r\n    case \"HANDLE_NOTES\":\r\n      return {\r\n        ...state,\r\n        notes: action.payload\r\n      };\r\n    case \"HANDLE_BOOKMARKS\":\r\n      return {\r\n        ...state,\r\n        bookmarks: action.payload\r\n      };\r\n    case \"HANDLE_EPUBS\":\r\n      return {\r\n        ...state,\r\n        epubs: action.payload\r\n      };\r\n    case \"HANDLE_COVERS\":\r\n      return {\r\n        ...state,\r\n        covers: action.payload\r\n      };\r\n\r\n    default:\r\n      return state;\r\n  }\r\n}\r\nexport function handleNotes(notes) {\r\n  return { type: \"HANDLE_NOTES\", payload: notes };\r\n}\r\nexport function handleBooks(books) {\r\n  return { type: \"HANDLE_BOOKS\", payload: books };\r\n}\r\nexport function handleSearchBooks(searchBooks) {\r\n  return { type: \"HANDLE_SEARCH_BOOKS\", payload: searchBooks };\r\n}\r\nexport function handleSearch(mode) {\r\n  return { type: \"HANDLE_SEARCH\", payload: mode };\r\n}\r\nexport function handleSort(mode) {\r\n  return { type: \"HANDLE_SORT\", payload: mode };\r\n}\r\nexport function handleList(mode) {\r\n  return { type: \"HANDLE_LIST\", payload: mode };\r\n}\r\nexport function handleMessage(message) {\r\n  console.log(message);\r\n  return { type: \"HANDLE_MESSAGE\", payload: message };\r\n}\r\nexport function handleMessageBox(mode) {\r\n  console.log(mode);\r\n  return { type: \"HANDLE_MESSAGE_BOX\", payload: mode };\r\n}\r\nexport function handleSortDisplay(mode) {\r\n  console.log(\"hdflhghgh\", mode);\r\n  return { type: \"HANDLE_SORT_DISPLAY\", payload: mode };\r\n}\r\nexport function handleSortCode(code) {\r\n  console.log(code);\r\n  return { type: \"HANDLE_SORT_CODE\", payload: code };\r\n}\r\nexport function handleEpubs(epubs) {\r\n  return { type: \"HANDLE_EPUBS\", payload: epubs };\r\n}\r\nexport function handleCovers(covers) {\r\n  return { type: \"HANDLE_COVERS\", payload: covers };\r\n}\r\nexport function handleBookmarks(bookmarks) {\r\n  return { type: \"HANDLE_COVERS\", payload: bookmarks };\r\n}\r\nexport function handleFetchBooks() {\r\n  return dispatch => {\r\n    localforage.getItem(\"books\", (err, value) => {\r\n      let bookArr = value;\r\n      dispatch(handleBooks(bookArr));\r\n      let epubArr = [];\r\n      if (bookArr === null) {\r\n        epubArr = null;\r\n      } else {\r\n        bookArr.forEach(item => {\r\n          // console.log(item, \"sgash\");\r\n\r\n          let epub = window.ePub({\r\n            bookPath: item.content,\r\n            restore: false\r\n          });\r\n          // console.log(epub, \"eashah\");\r\n          epubArr.push(epub);\r\n          dispatch(handleEpubs(epubArr));\r\n          let coverArr = [];\r\n          // async function getCovers(epubArr) {\r\n          epubArr.forEach(async (item, index) => {\r\n            await item.coverUrl().then(url => {\r\n              // console.log(url, \"urlsagasf\");\r\n              coverArr.push({ key: bookArr[index].key, url: url });\r\n              if (coverArr.length === bookArr.length) {\r\n                // console.log(coverArr, \"coverArr\");\r\n                dispatch(handleCovers(coverArr));\r\n              }\r\n            });\r\n          });\r\n        });\r\n      }\r\n    });\r\n  };\r\n}\r\nexport function handleFetchSortCode() {\r\n  return dispatch => {\r\n    let sortCode = OtherUtil.getSortCode();\r\n    dispatch(handleSortCode(sortCode));\r\n  };\r\n}\r\nexport function handleFetchList() {\r\n  return dispatch => {\r\n    let isList = localStorage.getItem(\"isList\") || \"card\";\r\n    dispatch(handleList(isList));\r\n  };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"./popupHighlight.css\";\r\nimport Highlighter from \"../../model/Highlighter\";\r\nimport localforage from \"localforage\";\r\nimport { handleMessageBox, handleMessage } from \"../../redux/manager.redux.js\";\r\nimport { connect } from \"react-redux\";\r\nclass PopupHighlight extends Component {\r\n  handleReturn = () => {\r\n    this.props.changeMenu(\"menu\");\r\n  };\r\n  handleClose = () => {\r\n    this.props.close();\r\n  };\r\n\r\n  componentDidMount() {\r\n    this.props.currentEpub.on(\"renderer:ChapterDisplayed\", () => {\r\n      this.getHighlighter();\r\n    });\r\n  }\r\n\r\n  handleHighlight(event) {\r\n    let iframe = document.getElementsByTagName(\"iframe\")[0];\r\n\r\n    let iDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n    let color = parseInt(event.target.dataset.color);\r\n    if (isNaN(color)) return;\r\n    // let note = this.createNote(color);\r\n    let classes = [\"color-0\", \"color-1\", \"color-2\", \"color-3\"];\r\n    let key = new Date().getTime() + \"\";\r\n    this.props.highlighter.highlightSelection(classes[color]);\r\n    // 清空文本选取\r\n    let book = this.props.currentBook;\r\n    let epub = this.props.currentEpub;\r\n    let sel = iDoc.getSelection();\r\n    let range = sel.getRangeAt(0);\r\n    let cfiBase = epub.renderer.currentChapter.cfiBase;\r\n    let cfi = new window.EPUBJS.EpubCFI().generateCfiFromRange(range, cfiBase);\r\n    let bookKey = book.key;\r\n    let charRange = window.rangy\r\n      .getSelection(iframe)\r\n      .saveCharacterRanges(iDoc.body)[0];\r\n    let serial = JSON.stringify(charRange);\r\n    //获取章节名\r\n\r\n    event.stopPropagation();\r\n    let highlighter = new Highlighter(key, bookKey, cfi, serial, color);\r\n    let highlighterArr = this.props.highlighters ? this.props.highlighters : [];\r\n    highlighterArr.push(highlighter);\r\n    localforage.setItem(\"highlighters\", highlighterArr);\r\n    this.props.closeMenu();\r\n    iDoc.getSelection().empty();\r\n    this.props.handleMessage(\"高亮成功\");\r\n    this.props.handleMessageBox(true);\r\n    console.log(\"%c Add note here. \", \"background-color: green\");\r\n  }\r\n\r\n  render() {\r\n    const renderHighlightList = () => {\r\n      return (\r\n        <div\r\n          className=\"highlight-list\"\r\n          style={this.props.isChangeDirection ? { marginTop: \"0px\" } : {}}\r\n        >\r\n          <div\r\n            className=\"highlight-return-button\"\r\n            onClick={() => {\r\n              this.handleReturn();\r\n            }}\r\n          >\r\n            <span className=\"icon-return\"></span>\r\n            <p className=\"highlight-text\">选择颜色</p>\r\n          </div>\r\n          <ul className=\"highlight-color\">\r\n            <li\r\n              className=\"highlight-color1\"\r\n              onClick={event => {\r\n                this.handleHighlight(event);\r\n              }}\r\n              data-color=\"0\"\r\n            ></li>\r\n            <li\r\n              className=\"highlight-color2\"\r\n              onClick={event => {\r\n                this.handleHighlight(event);\r\n              }}\r\n              data-color=\"1\"\r\n            ></li>\r\n            <li\r\n              className=\"highlight-color3\"\r\n              onClick={event => {\r\n                this.handleHighlight(event);\r\n              }}\r\n              data-color=\"2\"\r\n            ></li>\r\n            <li\r\n              className=\"highlight-color4\"\r\n              onClick={event => {\r\n                this.handleHighlight(event);\r\n              }}\r\n              data-color=\"3\"\r\n            ></li>\r\n          </ul>\r\n        </div>\r\n      );\r\n    };\r\n    return renderHighlightList();\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    notes: state.reader.notes,\r\n    chapters: state.reader.chapters,\r\n    highlighters: state.reader.highlighters\r\n  };\r\n};\r\nconst actionCreator = { handleMessageBox, handleMessage };\r\nPopupHighlight = connect(mapStateToProps, actionCreator)(PopupHighlight);\r\nexport default PopupHighlight;\r\n","class Note {\r\n  constructor(bookKey, chapter, text, cfi, range, notes) {\r\n    this.key = new Date().getTime() + \"\";\r\n    this.bookKey = bookKey;\r\n    this.date = {\r\n      year: new Date().getFullYear(),\r\n      month: new Date().getMonth() + 1,\r\n      day: new Date().getDate()\r\n    };\r\n    this.chapter = chapter;\r\n    this.text = text;\r\n    this.cfi = cfi;\r\n    this.range = range; // Rangy.js产生的将Range对象序列化后的字符串\r\n    this.notes = notes || \"\";\r\n  }\r\n}\r\n\r\nexport default Note;\r\n","import React, { Component } from \"react\";\r\nimport \"./popupNote.css\";\r\nimport { connect } from \"react-redux\";\r\nimport Note from \"../../model/Note\";\r\nimport localforage from \"localforage\";\r\nimport { handleMessageBox, handleMessage } from \"../../redux/manager.redux.js\";\r\nclass PopupNote extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n  }\r\n\r\n  createNote() {\r\n    // let { book, epub } = this.props;\r\n    let book = this.props.currentBook;\r\n    let epub = this.props.currentEpub;\r\n    let iframe = document.getElementsByTagName(\"iframe\")[0];\r\n    let iDoc = iframe.contentDocument;\r\n    let sel = iDoc.getSelection();\r\n    let range = sel.getRangeAt(0);\r\n    console.log(range, \"range\");\r\n    let notes = document.querySelector(\".editor-box\").value;\r\n    // let notes = editor.;\r\n    document.querySelector(\".editor-box\").value = \"\";\r\n    console.log(notes, \"note\");\r\n    let text = sel.toString();\r\n    text = text && text.trim();\r\n    let cfiBase = epub.renderer.currentChapter.cfiBase;\r\n    let cfi = new window.EPUBJS.EpubCFI().generateCfiFromRange(range, cfiBase);\r\n    let bookKey = book.key;\r\n    let charRange = window.rangy\r\n      .getSelection(iframe)\r\n      .saveCharacterRanges(iDoc.body)[0];\r\n    let serial = JSON.stringify(charRange);\r\n    //获取章节名\r\n    let index = this.props.chapters.findIndex(item => {\r\n      return item.spinePos > epub.renderer.currentChapter.spinePos;\r\n    });\r\n    // console.log(index, \"sahathth\");\r\n    let chapter =\r\n      this.props.chapters[index] !== undefined\r\n        ? this.props.chapters[index].label.trim(\" \")\r\n        : \"未知章节\";\r\n    // let chapter = epub.renderer.currentChapter.spinePos;\r\n\r\n    let note = new Note(bookKey, chapter, text, cfi, serial, notes);\r\n    let noteArr = this.props.notes ? this.props.notes : [];\r\n    noteArr.push(note);\r\n    localforage.setItem(\"notes\", noteArr);\r\n    this.props.closeMenu();\r\n    iDoc.getSelection().empty();\r\n    this.props.handleMessage(\"添加成功\");\r\n    this.props.handleMessageBox(true);\r\n    // return note;\r\n  }\r\n  handleReturn = () => {\r\n    this.props.changeMenu(\"menu\");\r\n    this.props.openMenu();\r\n  };\r\n  handleClose = () => {\r\n    this.props.closeMenu();\r\n  };\r\n  render() {\r\n    const renderNoteEditor = () => {\r\n      return (\r\n        <div className=\"note-editor\">\r\n          <div\r\n            className=\"note-return-button\"\r\n            onClick={() => {\r\n              this.handleReturn();\r\n            }}\r\n          >\r\n            <span className=\"icon-return\"></span>\r\n          </div>\r\n          <textarea\r\n            type=\"text\"\r\n            className=\"editor-box\"\r\n            placeholder=\"请在此输入您的笔记\"\r\n          />\r\n\r\n          <span\r\n            className=\"confirm-button\"\r\n            onClick={() => {\r\n              this.createNote();\r\n            }}\r\n          >\r\n            确认\r\n          </span>\r\n          <span\r\n            className=\"cancel-button\"\r\n            onClick={() => {\r\n              this.handleClose();\r\n            }}\r\n          >\r\n            取消\r\n          </span>\r\n        </div>\r\n      );\r\n    };\r\n    return renderNoteEditor();\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    notes: state.reader.notes,\r\n    chapters: state.reader.chapters\r\n  };\r\n};\r\nconst actionCreator = { handleMessageBox, handleMessage };\r\nPopupNote = connect(mapStateToProps, actionCreator)(PopupNote);\r\nexport default PopupNote;\r\n","class Digest {\r\n  constructor(bookKey, chapter, text, cfi) {\r\n    this.key = new Date().getTime() + \"\";\r\n    this.date = {\r\n      year: new Date().getFullYear(),\r\n      month: new Date().getMonth() + 1,\r\n      day: new Date().getDate()\r\n    };\r\n    this.bookKey = bookKey;\r\n    this.chapter = chapter;\r\n    this.text = text;\r\n    this.cfi = cfi;\r\n  }\r\n}\r\n\r\nexport default Digest;\r\n","const initState = {\r\n  selection: null,\r\n  highlighters: []\r\n  // cover:''\r\n};\r\nexport function viewArea(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"HANDLE_OPEN_MENU\":\r\n      return {\r\n        ...state,\r\n        isOpenMenu: action.payload\r\n      };\r\n    case \"HANDLE_OPEN_HIGHLIGHT\":\r\n      return {\r\n        ...state,\r\n        isOpenHighlight: action.payload\r\n      };\r\n    case \"HANDLE_OPEN_NOTE\":\r\n      return {\r\n        ...state,\r\n        isOpenNote: action.payload\r\n      };\r\n    case \"HANDLE_SELECTION\":\r\n      return {\r\n        ...state,\r\n        selection: action.payload\r\n      };\r\n    case \"HANDLE_DIALOG_LOCATION\":\r\n      return {\r\n        ...state,\r\n        dialogLocation: action.payload\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport function handleOpenMenu(isOpenMenu) {\r\n  console.log(isOpenMenu);\r\n  return { type: \"HANDLE_OPEN_MENU\", payload: isOpenMenu };\r\n}\r\nexport function handleOpenHighlight(isOpenHighlight) {\r\n  return { type: \"HANDLE_OPEN_HIGHLIGHT\", payload: isOpenHighlight };\r\n}\r\nexport function handleOpenNote(isOpenNote) {\r\n  return { type: \"HANDLE_OPEN_NOTE\", payload: isOpenNote };\r\n}\r\nexport function handleSelection(selection) {\r\n  console.log(\"copy \");\r\n  return { type: \"HANDLE_SELECTION\", payload: selection };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"./popupOption.css\";\r\nimport { connect } from \"react-redux\";\r\nimport localforage from \"localforage\";\r\nimport Digest from \"../../model/Digest\";\r\nimport { handleMessageBox, handleMessage } from \"../../redux/manager.redux.js\";\r\n\r\nimport {\r\n  handleOpenNote,\r\n  handleOpenHighlight,\r\n  handleOpenMenu\r\n} from \"../../redux/viewArea.redux\";\r\nclass PopupOption extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n  }\r\n  handleNote = () => {\r\n    this.props.changeMenu(\"note\");\r\n  };\r\n  handleHighlight = () => {\r\n    this.props.changeMenu(\"highlight\");\r\n  };\r\n  handleCopy = () => {\r\n    // let selection = this.props.selection;\r\n    // console.log(selection);\r\n    let iDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n    let text = iDoc.execCommand(\"copy\", false, null);\r\n    !text\r\n      ? console.log(\"failed to copy text to clipboard\")\r\n      : console.log(\"copied!\");\r\n    this.props.closeMenu();\r\n    iDoc.getSelection().empty();\r\n    this.props.handleMessage(\"复制成功\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  handleDigest = () => {\r\n    let book = this.props.currentBook;\r\n    let epub = this.props.currentEpub;\r\n    let iframe = document.getElementsByTagName(\"iframe\")[0];\r\n    let iDoc = iframe.contentDocument;\r\n    let sel = iDoc.getSelection();\r\n    let range = sel.getRangeAt(0);\r\n\r\n    let text = sel.toString();\r\n    text = text && text.trim();\r\n    let cfiBase = epub.renderer.currentChapter.cfiBase;\r\n    let cfi = new window.EPUBJS.EpubCFI().generateCfiFromRange(range, cfiBase);\r\n    let bookKey = book.key;\r\n\r\n    //获取章节名\r\n    let index = this.props.chapters.findIndex(item => {\r\n      return item.spinePos > epub.renderer.currentChapter.spinePos;\r\n    });\r\n    // console.log(index, \"sahathth\");\r\n    let chapter =\r\n      this.props.chapters[index] !== undefined\r\n        ? this.props.chapters[index].label.trim(\" \")\r\n        : \"未知章节\";\r\n    // let chapter = epub.renderer.currentChapter.spinePos;\r\n\r\n    let digest = new Digest(bookKey, chapter, text, cfi);\r\n    let digestArr = this.props.digests ? this.props.digests : [];\r\n    digestArr.push(digest);\r\n    localforage.setItem(\"digests\", digestArr);\r\n    this.props.closeMenu();\r\n    iDoc.getSelection().empty();\r\n    this.props.handleMessage(\"添加成功\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  // return note;};\r\n  render() {\r\n    const renderMenuList = () => {\r\n      return (\r\n        <div className=\"menu-list\">\r\n          <div\r\n            className=\"note-option\"\r\n            onClick={() => {\r\n              this.handleNote();\r\n            }}\r\n          >\r\n            <div>\r\n              <span className=\"icon-note note-icon\"></span>\r\n              <p>记笔记</p>\r\n            </div>\r\n          </div>\r\n          <div\r\n            className=\"digest-option\"\r\n            onClick={() => {\r\n              this.handleDigest();\r\n            }}\r\n          >\r\n            <div>\r\n              <span className=\"icon-collect digest-icon\"></span>\r\n              <p>收藏</p>\r\n            </div>\r\n          </div>\r\n          <div\r\n            className=\"highlight-option\"\r\n            onClick={() => {\r\n              this.handleHighlight();\r\n            }}\r\n          >\r\n            <div>\r\n              <span className=\"icon-highlight highlight-icon\"></span>\r\n              <p>高亮</p>\r\n            </div>\r\n          </div>\r\n          <div\r\n            className=\"copy-option icon\"\r\n            onClick={() => {\r\n              this.handleCopy();\r\n            }}\r\n          >\r\n            <div>\r\n              <span className=\"icon-copy copy-icon\"></span>\r\n              <p>复制</p>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      );\r\n    };\r\n    return renderMenuList();\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    currentBook: state.book.currentBook,\r\n    currentEpub: state.book.currentEpub,\r\n    // locations: state.progressPanel.locations\r\n    isOpenMenu: state.viewArea.isOpenMenu,\r\n    selection: state.viewArea.selection,\r\n    digests: state.reader.digests,\r\n    chapters: state.reader.chapters\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleOpenNote,\r\n  handleOpenHighlight,\r\n  handleOpenMenu,\r\n  handleMessageBox,\r\n  handleMessage\r\n};\r\nPopupOption = connect(mapStateToProps, actionCreator)(PopupOption);\r\nexport default PopupOption;\r\n","import React, { Component } from \"react\";\r\nimport \"./popupMenu.css\";\r\nimport PopupHighlist from \"../popupHighlight/popupHighlight\";\r\nimport PopuoNote from \"../popupNote/popupNote\";\r\nimport PopupOption from \"../popupOption/popupOption\";\r\nimport { handleSelection } from \"../../redux/viewArea.redux\";\r\nimport { connect } from \"react-redux\";\r\nclass PopupMenu extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      mode: \"menu\",\r\n      isOpenMenu: false,\r\n      isChangeDirection: false\r\n      // key: null\r\n    };\r\n    this.highlighter = null;\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.props.currentEpub.on(\"renderer:chapterDisplayed\", () => {\r\n      let doc = this.props.currentEpub.renderer.doc;\r\n      this.getHighlighter();\r\n      setTimeout(() => {\r\n        this.renderHighlighters();\r\n      }, 100);\r\n\r\n      doc.addEventListener(\"click\", this.openMenu);\r\n    });\r\n  }\r\n  setKey = key => {\r\n    console.log(key, \"key\");\r\n    this.setState({ key: key });\r\n  };\r\n  getHighlighter = () => {\r\n    // 注意点一\r\n    // 为了每次切换章节时都有与当前文档相关联的 pen\r\n    let iDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n    this.highlighter = window.rangy.createHighlighter(iDoc);\r\n    let classes = [\"color-0\", \"color-1\", \"color-2\", \"color-3\"];\r\n\r\n    classes.forEach(item => {\r\n      let config = {\r\n        ignoreWhiteSpace: true,\r\n        elementTagName: \"span\",\r\n        elementProperties: {\r\n          onclick: event => {\r\n            let iDoc = document.getElementsByTagName(\"iframe\")[0]\r\n              .contentDocument;\r\n            let sel = iDoc.getSelection();\r\n            if (!sel.isCollapsed) return;\r\n            let key = event.currentTarget.dataset.key;\r\n            console.log(key);\r\n            this.openMenu();\r\n            event.stopPropagation();\r\n\r\n            // if (this.state.openMenu) this.setState({ openMenu: false }); // 修复bug\r\n          }\r\n        },\r\n        onElementCreate: element => {\r\n          // console.log(this.state.key, \"fhdgh\");\r\n          element.dataset.key = this.key;\r\n        }\r\n      };\r\n      let applier = window.rangy.createClassApplier(item, config);\r\n      this.highlighter.addClassApplier(applier);\r\n      console.log(\"applier\");\r\n    });\r\n  };\r\n  renderHighlighters = () => {\r\n    // TODO: 注意点二\r\n    console.log(\r\n      \"%c renderNotes has been called! \",\r\n      \"color: cyan; background: #333333\"\r\n    );\r\n\r\n    let { highlighters } = this.props;\r\n    let iframe = document.getElementsByTagName(\"iframe\")[0];\r\n    let iWin = iframe.contentWindow || iframe.contentDocument.defaultView;\r\n    let sel = window.rangy.getSelection(iframe);\r\n    // console.log(sel);\r\n    let serial = window.rangy.serializeSelection(sel, true);\r\n    // console.log(serial);\r\n    this.highlighter && this.highlighter.removeAllHighlights(); // 为了避免下次反序列化失败，必须先清除已有的高亮\r\n\r\n    let classes = [\"color-0\", \"color-1\", \"color-2\", \"color-3\"];\r\n    // console.log(highlighters, \"hsdufj\");\r\n    highlighters !== null &&\r\n      highlighters.forEach(item => {\r\n        this.key = item.key;\r\n        // console.log(this.key, \"sadgasf\");\r\n        try {\r\n          let temp = JSON.parse(item.range);\r\n          temp = [temp];\r\n          // console.log(temp, \"test\");\r\n          window.rangy\r\n            .getSelection(iframe)\r\n            .restoreCharacterRanges(iframe.contentDocument, temp);\r\n        } catch (e) {\r\n          console.warn(\r\n            \"Exception has been caught when restore character ranges.\"\r\n          );\r\n          return;\r\n        }\r\n\r\n        this.highlighter.highlightSelection(classes[item.color]);\r\n      });\r\n\r\n    iWin.getSelection().empty(); // 清除文本选取\r\n    this.state.isOpenMenu &&\r\n      window.rangy.deserializeSelection(serial, null, iWin); // （为了选取文本后不被上一行代码清除掉）恢复原本的文本选取\r\n  };\r\n  openMenu = event => {\r\n    let iframe = document.getElementsByTagName(\"iframe\")[0];\r\n    let iDoc = iframe.contentDocument;\r\n    let sel = iDoc.getSelection();\r\n    // this.props.handleSelection(sel.toString());\r\n    this.setState({ isChangeDirection: false });\r\n    // 如果 note card 正在被展示，则隐藏\r\n    if (this.state.isOpenMenu) {\r\n      // this.setState({ isOpenMenu: false });\r\n      this.closeMenu();\r\n    }\r\n    console.log(this.state.isOpenMenu, \"fhadh\");\r\n    // 使弹出菜单更加灵活可控\r\n    if (sel.isCollapsed) {\r\n      this.props.isOpenMenu && this.closeMenu();\r\n      return;\r\n    }\r\n\r\n    let rect = this.props.currentEpub.renderer.rangePosition(sel.getRangeAt(0));\r\n    console.log(rect);\r\n\r\n    let height = 200;\r\n    let posX = rect.x + rect.width / 2 - 20;\r\n\r\n    let rightEdge = this.props.currentEpub.renderer.width - 154;\r\n    console.log(this.props.currentEpub.renderer.width);\r\n    var posY;\r\n\r\n    if (rect.y < height) {\r\n      this.setState({ isChangeDirection: true });\r\n      posY = rect.y + 77;\r\n    } else {\r\n      posY = rect.y - height / 2 - rect.height;\r\n    }\r\n    // let\r\n    posY = posY < 6 ? 6 : posY;\r\n    posX =\r\n      posX < 10\r\n        ? 10\r\n        : this.state.mode === \"note\"\r\n        ? rect.x > rightEdge\r\n          ? rightEdge\r\n          : posX\r\n        : posX;\r\n    this.setState({ isOpenMenu: true });\r\n    // console.log(posX, posY, \"fjkhfjkfku\");\r\n    let popupMenu = document.querySelector(\".popup-menu-container\");\r\n    popupMenu.setAttribute(\"style\", `left:${posX}px;top:${posY}px`);\r\n  };\r\n  closeMenu = () => {\r\n    this.setState({ isOpenMenu: false });\r\n  };\r\n  changeMenu = mode => {\r\n    this.setState({ mode: mode });\r\n  };\r\n  render() {\r\n    return (\r\n      <div>\r\n        {this.state.isOpenMenu ? (\r\n          <div className=\"popup-menu-container\">\r\n            <div className=\"popup-menu-box\">\r\n              {this.state.mode === \"menu\" ? (\r\n                <PopupOption\r\n                  closeMenu={this.closeMenu}\r\n                  changeMenu={this.changeMenu}\r\n                />\r\n              ) : this.state.mode === \"note\" ? (\r\n                <PopuoNote\r\n                  closeMenu={this.closeMenu}\r\n                  openMenu={this.openMenu}\r\n                  changeMenu={this.changeMenu}\r\n                />\r\n              ) : (\r\n                <PopupHighlist\r\n                  closeMenu={this.closeMenu}\r\n                  changeMenu={this.changeMenu}\r\n                  highlighter={this.highlighter}\r\n                  isChangeDirection={this.state.isChangeDirection}\r\n                />\r\n              )}\r\n            </div>\r\n            {this.state.isChangeDirection ? (\r\n              <span\r\n                className=\"icon-popup popup-menu-triangle-up\"\r\n                style={\r\n                  this.state.mode === \"highlight\" ? { bottom: \"110px\" } : {}\r\n                }\r\n              ></span>\r\n            ) : (\r\n              <span className=\"icon-popup popup-menu-triangle-down\"></span>\r\n            )}\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    currentEpub: state.book.currentEpub,\r\n    isOpenMenu: state.viewArea.isOpenMenu,\r\n    isOpenHighlight: state.viewArea.isOpenHighlight,\r\n    isOpenNote: state.viewArea.isOpenNote,\r\n    highlighters: state.reader.highlighters\r\n  };\r\n};\r\nconst actionCreator = { handleSelection };\r\nPopupMenu = connect(mapStateToProps, actionCreator)(PopupMenu);\r\nexport default PopupMenu;\r\n","// 阅读期间自动记录当前阅读位置\r\nclass RecordLocation {\r\n  static recordCfi(bookKey, cfi, percentage) {\r\n    let json = localStorage.getItem(\"recordLocation\");\r\n    let obj = JSON.parse(json) || {};\r\n    obj[bookKey] = { cfi: cfi, percentage: percentage };\r\n    // console.log(cfi, \"dfhdafhdfh\");\r\n    localStorage.setItem(\"recordLocation\", JSON.stringify(obj));\r\n  }\r\n\r\n  static getCfi(bookKey) {\r\n    let json = localStorage.getItem(\"recordLocation\");\r\n    let obj = JSON.parse(json) || {};\r\n\r\n    return obj[bookKey] || {};\r\n  }\r\n\r\n  static clear(bookKey) {\r\n    let json = localStorage.getItem(\"recordLocation\");\r\n    let obj = JSON.parse(json) || {};\r\n    delete obj[bookKey];\r\n\r\n    localStorage.setItem(\"recordLocation\", JSON.stringify(obj));\r\n  }\r\n}\r\n\r\nexport default RecordLocation;\r\n","class readerConfig {\r\n  // 获取默认的配置\r\n  static getDefaultConfigObj() {\r\n    return {\r\n      theme: \"rgba(255,254,252,1)\",\r\n      fontFamily: \"Source Han Sans CN\",\r\n      fontWeight: 300,\r\n      fontSize: 17, // 0 代表使用默认值\r\n      lineHeight: 1.25, // 0 代表使用默认值\r\n      column: 2, // 可取值为1, 2\r\n      padding: 50, // 阅读区域与浏览器可视区域上下的间距\r\n      disablePopup: false,\r\n      progress: 0,\r\n      colors: [\"#FBF1D1\", \"#EFEEB0\", \"#CAEFC9\", \"#76BEE9\"]\r\n    };\r\n  }\r\n\r\n  // 获取config对象\r\n  static get() {\r\n    let json = localStorage.getItem(\"config\");\r\n\r\n    return JSON.parse(json) || readerConfig.getDefaultConfigObj(); //若localstorage中不存在数据，就赋予默认值\r\n  }\r\n\r\n  // 更新config\r\n  static set(key, value) {\r\n    let json = localStorage.getItem(\"config\"); //获取json格式的数据\r\n    let config = JSON.parse(json) || readerConfig.getDefaultConfigObj(); //将json数据转换为对象\r\n    config[key] = value;\r\n    localStorage.setItem(\"config\", JSON.stringify(config));\r\n  }\r\n\r\n  // 重置Config\r\n  static resetConfig() {\r\n    let json = JSON.stringify(readerConfig.getDefaultConfigObj()); //对象转json\r\n    localStorage.setItem(\"config\", json);\r\n  }\r\n\r\n  // 获取为文档默认应用的css样式\r\n  static getDefaultCss() {\r\n    let config = readerConfig.get();\r\n    let colors = config.colors;\r\n\r\n    let css1 = `::selection{background:#f3a6a68c}::-moz-selection{background:#f3a6a68c}[class*=color-]:hover{cursor:pointer;background-image:linear-gradient(0,rgba(0,0,0,.075),rgba(0,0,0,.075))}.color-0{background-color:${colors[0]}}.color-1{background-color:${colors[1]}}.color-2{background-color:${colors[2]}}.color-3{background-color:${colors[3]}}`;\r\n    // console.log(config, \"config\");\r\n    let css2 = [\r\n      \"a, article, cite, code, div, li, p, pre, span, table {\",\r\n      `    font-size: ${config.fontSize + \"px\"} !important;`,\r\n      `    line-height: ${config.lineHeight} !important;`,\r\n      `    letter-spacing: ${config.letterSpacing + \"px\"} !important;`,\r\n      `    font-family: \"${config.fontFamily}\" !important;`,\r\n      \"}\",\r\n      \"img {\",\r\n      \"    max-width: 100% !important;\",\r\n      \"}\"\r\n    ];\r\n    // let css3 = [`padding:${config.padding} !important;`];\r\n\r\n    return css1 + css2.join(\"\\n\");\r\n  }\r\n}\r\nexport const themeList = [\r\n  { id: 1, theme: \"rgba(235,255,231,1)\" },\r\n  { id: 2, theme: \"rgba(75,75,75,1)\" },\r\n  { id: 3, theme: \"rgba(242,219,187,1)\" },\r\n  { id: 4, theme: \"rgba(255,254,252,1)\" }\r\n];\r\nexport const fontSizeList = [\r\n  { id: 1, size: \"小\", num: 15 },\r\n  { id: 2, size: \"中\", num: 17 },\r\n  { id: 3, size: \"大\", num: 20 },\r\n  { id: 4, size: \"特大\", num: 23 },\r\n  { id: 5, size: \"超大\", num: 26 }\r\n];\r\nexport const dropdownList = [\r\n  {\r\n    id: 1,\r\n    title: \"字体\",\r\n    value: \"fontFamily\",\r\n\r\n    option: [\r\n      { id: 1, name: \"默认(思源黑体)\", value: \"Source Han Sans CN\" },\r\n      { id: 2, name: \"思源宋体\", value: \"Source Han Serif CN\" },\r\n      { id: 3, name: \"思源黑体\", value: \"Source Han Sans CN\" },\r\n      { id: 4, name: \"微软雅黑\", value: \"Microsoft Yahei\" },\r\n      { id: 5, name: \"黑体\", value: \"SimHei\" },\r\n      { id: 6, name: \"Aril\", value: \"Aril\" }\r\n    ]\r\n  },\r\n  {\r\n    id: 2,\r\n    title: \"行间距\",\r\n    value: \"lineHeight\",\r\n\r\n    option: [\r\n      { id: 1, name: \"默认(1.25倍)\", value: 1.25 },\r\n      { id: 2, name: \"1倍\", value: 1 },\r\n      {\r\n        id: 3,\r\n        name: \"1.25倍\",\r\n        value: 1.25\r\n      },\r\n      { id: 4, name: \"1.5倍\", value: 1.5 },\r\n      {\r\n        id: 5,\r\n        name: \"1.75倍\",\r\n        value: 1.75\r\n      },\r\n      { id: 6, name: \"2倍\", value: 2 }\r\n    ]\r\n  },\r\n  {\r\n    id: 3,\r\n    title: \"页边距\",\r\n    value: \"padding\",\r\n\r\n    option: [\r\n      { id: 1, name: \"默认(中等)\", value: 50 },\r\n      { id: 2, name: \"超窄\", value: 10 },\r\n      { id: 3, name: \"窄\", value: 30 },\r\n      { id: 4, name: \"中等\", value: 50 },\r\n      { id: 5, name: \"宽\", value: 70 },\r\n      { id: 6, name: \"超宽\", value: 90 }\r\n    ]\r\n  }\r\n];\r\nexport const sideMenu = [\r\n  {\r\n    name: \"全部图书\",\r\n    icon: \"home\",\r\n    mode: \"home\"\r\n    // action: fetchRecentlyPlayed\r\n  },\r\n  {\r\n    name: \"最近阅读\",\r\n    icon: \"recent\",\r\n    mode: \"recent\"\r\n    // action: fetchSongs\r\n  },\r\n  {\r\n    name: \"我的书签\",\r\n    icon: \"bookmark\",\r\n    mode: \"bookmark\"\r\n    // action: fetchAlbums\r\n  },\r\n  {\r\n    name: \"我的笔记\",\r\n    icon: \"idea\",\r\n    mode: \"note\"\r\n    // action: fetchArtists,\r\n    // getArtists: true\r\n  },\r\n\r\n  {\r\n    name: \"我的书摘\",\r\n    icon: \"digest\",\r\n    mode: \"digest\"\r\n  }\r\n];\r\nexport const driveList = [\r\n  {\r\n    id: 1,\r\n    name: \"Dropbox\",\r\n    icon: \"dropbox\"\r\n    // action: fetchRecentlyPlayed\r\n  },\r\n  {\r\n    id: 2,\r\n    name: \"OneDrive\",\r\n    icon: \"onedrive\"\r\n    // action: fetchSongs\r\n  },\r\n  {\r\n    id: 3,\r\n    name: \"Google Drive\",\r\n    icon: \"googledrive\"\r\n  },\r\n  {\r\n    id: 4,\r\n    name: \"Mega Drive\",\r\n    icon: \"mega\"\r\n  },\r\n\r\n  {\r\n    id: 5,\r\n    name: \"WebDav\",\r\n    icon: \"webdav\"\r\n  }\r\n];\r\nexport const emptyList = [\r\n  {\r\n    mode: \"home\",\r\n    main: \"您的图书库为空\",\r\n    sub: \"请点击右上角的图标添加图书\"\r\n  },\r\n  {\r\n    mode: \"recent\",\r\n    main: \"您没有阅读记录\",\r\n    sub: \"点击任意一本书开始阅读\"\r\n  },\r\n  {\r\n    mode: \"bookmark\",\r\n    main: \"您的书签为空\",\r\n    sub: \"在阅读器界面，将鼠标移至上边缘处，在弹出的菜单栏中添加书签\"\r\n  },\r\n  {\r\n    mode: \"note\",\r\n    main: \"您的笔记为空\",\r\n    sub: \"在阅读器界面，选中文字后，在弹出的对话框中添加笔记\"\r\n  },\r\n  {\r\n    mode: \"digest\",\r\n    main: \"您的书摘为空\",\r\n    sub: \"在阅读器界面，选中文字后，在弹出的对话框中点击收藏\"\r\n  },\r\n  {\r\n    mode: \"shelf\",\r\n    main: \"您的书架为空\",\r\n    sub: \"将鼠标移动到任意书本上方，在弹出的菜单中点击加号添加到书架\"\r\n  }\r\n];\r\nexport default readerConfig;\r\n","// 工具类\r\nimport ReaderConfig from \"./readerConfig\";\r\n\r\nclass StyleConfig {\r\n  // 获取元素的样式\r\n  static getStyle(element, attr) {\r\n    if (element.currentStyle !== null) {\r\n      return element.currentStyle[attr];\r\n    } else {\r\n      return getComputedStyle(element)[attr];\r\n    }\r\n  }\r\n\r\n  // 为指定文档添加(user)脚本\r\n  static addScript(script, doc = document) {\r\n    let scriptEl = doc.getElementById(\"qiu-user-script\");\r\n\r\n    if (!scriptEl) {\r\n      scriptEl = doc.createElement(\"script\");\r\n      scriptEl.id = \"qiu-user-script\";\r\n      scriptEl.type = \"text/javascript\";\r\n      scriptEl.defer = true;\r\n      scriptEl.text = script;\r\n      doc.body.appendChild(scriptEl);\r\n      return;\r\n    }\r\n\r\n    scriptEl.text = script;\r\n  }\r\n\r\n  // 为指定文档添加(user)样式\r\n  static addCss(css, doc = document) {\r\n    let style = doc.getElementById(\"qiu-user-style\");\r\n\r\n    if (!style) {\r\n      style = doc.createElement(\"style\");\r\n      style.id = \"qiu-user-style\";\r\n      style.textContent = css;\r\n      doc.head.appendChild(style);\r\n      return;\r\n    }\r\n\r\n    style.textContent = css;\r\n  }\r\n\r\n  // 为 iframe 添加默认的样式\r\n  static addDefaultCss() {\r\n    let css = ReaderConfig.getDefaultCss();\r\n    let iDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n    let style = iDoc.getElementById(\"default-style\");\r\n    let background = document.querySelector(\".background\");\r\n    // let iframe = document.querySelector(\"iframe\");\r\n    background.setAttribute(\r\n      \"style\",\r\n      `background-color:${ReaderConfig.get().theme}`\r\n    );\r\n    // let height =\r\n    //   document.documentElement.clientHeight - ReaderConfig.get().padding * 2;\r\n    // console.log(ReaderConfig.get().padding, \"height\");\r\n    // let width =\r\n    //   document.documentElement.clientWidth - ReaderConfig.get().padding * 2;\r\n    // iframe.setAttribute(\"width\", `${width}px`);\r\n    // iframe.setAttribute(\"height\", `${height}px`);\r\n    // iframe.setAttribute(\r\n    //   \"style\",\r\n    //   ` position: relative; left:${ReaderConfig.get().padding}px; top:${\r\n    //     ReaderConfig.get().padding\r\n    //   }px;`\r\n    // );\r\n    // iFrame.removeAttribute(\"width\");\r\n    // iFrame.removeAttribute(\"width\");\r\n    // iFrame.setAttribute(\"style\", ``);\r\n    if (!style) {\r\n      style = iDoc.createElement(\"style\");\r\n      style.id = \"default-style\";\r\n      style.textContent = css;\r\n\r\n      iDoc.head.appendChild(style);\r\n      return;\r\n    }\r\n    style.textContent = css;\r\n  }\r\n\r\n  // 获取用户自定义的样式\r\n  // 返回一个对象 {outer: outerStyle, inner: innerStyle}\r\n  static getUserStyle() {\r\n    let json = localStorage.getItem(\"style\") || \"{}\";\r\n\r\n    return JSON.parse(json);\r\n  }\r\n\r\n  // 解析用户传入的样式表\r\n  static parseStyle(style) {\r\n    const separator = \"/* Qiu Plus Separator */\";\r\n    let arr = style.split(separator);\r\n    let out = {\r\n      inner: arr[0] || \"\",\r\n      outer: arr[1] || \"\"\r\n    };\r\n\r\n    return out;\r\n  }\r\n\r\n  // 获取用户自定义的脚本\r\n  // 返回一个对象 {outer: outerScript, inner: innerScript}\r\n  static getUserScript() {\r\n    let json = localStorage.getItem(\"script\") || \"{}\";\r\n\r\n    return JSON.parse(json);\r\n  }\r\n\r\n  // 解析用户传入的脚本\r\n  static parseScript(script) {\r\n    const separator = \"/* Qiu Plus Separator */\";\r\n    let arr = script.split(separator);\r\n    let out = {\r\n      inner: arr[0] || \"\",\r\n      outer: arr[1] || \"\"\r\n    };\r\n\r\n    return out;\r\n  }\r\n\r\n  // 应用外部的样式\r\n  static applyCss() {\r\n    let outerDoc = document;\r\n    let innerDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n    let style = StyleConfig.getUserStyle();\r\n    style.inner && StyleConfig.addCss(style.inner, innerDoc);\r\n    style.outer && StyleConfig.addCss(style.outer, outerDoc);\r\n  }\r\n\r\n  // 应用外部的样式\r\n  static applyScript() {\r\n    let outerDoc = document;\r\n    let innerDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n    let script = StyleConfig.getUserScript();\r\n    script.inner && StyleConfig.addCss(script.inner, innerDoc);\r\n    script.outer && StyleConfig.addCss(script.outer, outerDoc);\r\n  }\r\n\r\n  // 取消自定义的样式\r\n  static resetStyle() {\r\n    let style = {\r\n      inner: \" \",\r\n      outer: \" \"\r\n    };\r\n    localStorage.setItem(\"style\", JSON.stringify(style));\r\n    ReaderConfig.resetConfig();\r\n\r\n    StyleConfig.applyCss();\r\n    StyleConfig.addDefaultCss();\r\n  }\r\n\r\n  // 取消用户自定义脚本\r\n  static resetScript() {\r\n    let script = {\r\n      inner: \" \",\r\n      outer: \" \"\r\n    };\r\n    localStorage.setItem(\"script\", JSON.stringify(script));\r\n    StyleConfig.applyScript();\r\n  }\r\n}\r\n\r\nexport default StyleConfig;\r\n","// import localforage from \"localforage\";\r\nimport RecordLocation from \"../utils/recordLocation\";\r\nconst initState = {\r\n  percentage: null,\r\n  section: null,\r\n  locations: null\r\n};\r\nexport function progressPanel(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"HANDLE_PERCENTAGE\":\r\n      return {\r\n        ...state,\r\n        percentage: action.payload\r\n      };\r\n\r\n    case \"HANDLE_SECTION\":\r\n      return {\r\n        ...state,\r\n        section: action.payload\r\n      };\r\n    case \"HANDLE_LOCATIONS\":\r\n      return {\r\n        ...state,\r\n        locations: action.payload\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport function handleSection(section) {\r\n  return { type: \"HANDLE_SECTION\", payload: section };\r\n}\r\nexport function handleLocations(locations) {\r\n  return { type: \"HANDLE_LOCATIONS\", payload: locations };\r\n}\r\nexport function handlePercentage(percentage) {\r\n  console.log(percentage, \"jkjlll\");\r\n  return { type: \"HANDLE_PERCENTAGE\", payload: percentage };\r\n}\r\nexport function handleFetchPercentage(book) {\r\n  return dispatch => {\r\n    let percentage = RecordLocation.getCfi(book.key).percentage;\r\n    console.log(percentage, \"percentage\");\r\n    dispatch(handlePercentage(percentage));\r\n  };\r\n}\r\nexport function handleFetchLocations(epub) {\r\n  return dispatch => {\r\n    console.log(epub);\r\n    if (epub.locations !== undefined) {\r\n      epub.locations.generate().then(result => {\r\n        let locations = epub.locations;\r\n        console.log(\"sfhafshfhafh\");\r\n        dispatch(handleLocations(locations));\r\n      });\r\n    }\r\n  };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport RecordLocation from \"../../utils/recordLocation\";\r\nimport { connect } from \"react-redux\";\r\nimport { MouseEvent } from \"../../utils/mouseEvent\";\r\nimport { handlePercentage } from \"../../redux/progressPanel.redux\";\r\nimport { handleOpenMenu } from \"../../redux/viewArea.redux.js\";\r\nclass ViewPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isSingle: localStorage.getItem(\"isSingle\") || \"double\" };\r\n  }\r\n  componentWillUnmount() {\r\n    document.removeEventListener(\"copy\", this.copyTextHack);\r\n  }\r\n  componentDidMount() {\r\n    let page = document.querySelector(\"#page-area\");\r\n    console.log(page, \"fahfgf\");\r\n    let epub = this.props.currentEpub;\r\n    window.rangy.init(); // 初始化\r\n\r\n    epub.renderTo(page);\r\n    MouseEvent(epub, this.props.currentBook.key); // 绑定事件\r\n    // 渲染\r\n    // addEventListener('')\r\n    epub.on(\"renderer:locationChanged\", () => {\r\n      let cfi = epub.getCurrentLocationCfi();\r\n      if (this.props.locations) {\r\n        let percentage = this.props.locations.percentageFromCfi(cfi);\r\n        console.log(percentage, \"sahafhfh\");\r\n        // console.log(percentage, \"dgafhdafha\");\r\n        RecordLocation.recordCfi(this.props.currentBook.key, cfi, percentage);\r\n        this.props.handlePercentage(percentage);\r\n      }\r\n    });\r\n    // console.log(AutoBookmark.getCfi(this.props.currentBook.key).cfi);\r\n    epub.gotoCfi(\r\n      RecordLocation.getCfi(this.props.currentBook.key) === null\r\n        ? null\r\n        : RecordLocation.getCfi(this.props.currentBook.key).cfi\r\n    );\r\n    this.copyTextHack = event => {\r\n      let iDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n      let copyText =\r\n        iDoc.getSelection().toString() || document.getSelection().toString();\r\n      event.clipboardData.setData(\"text/plain\", copyText);\r\n      event.preventDefault();\r\n    };\r\n    document.addEventListener(\"copy\", this.copyTextHack);\r\n  }\r\n\r\n  render() {\r\n    // console.log(this.state.isSingle, \"sdgsFHADFH\");\r\n    this.props.currentEpub.renderer.forceSingle(\r\n      this.state.isSingle === \"single\"\r\n    );\r\n    // localStorage.setItem(\"isSingle\", this.state.isSingle);\r\n    return (\r\n      <div\r\n        className=\"view-area-page\"\r\n        id=\"page-area\"\r\n      ></div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    currentBook: state.book.currentBook,\r\n    currentEpub: state.book.currentEpub,\r\n    locations: state.progressPanel.locations,\r\n    isSingle: state.reader.isSingle\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handlePercentage,\r\n  handleOpenMenu\r\n};\r\nViewPage = connect(mapStateToProps, actionCreator)(ViewPage);\r\nexport default ViewPage;\r\n","// import recordLocation from \"./recordLocation\";\r\nimport StyleConfig from \"./styleConfig\";\r\n// import ReaderConfig from \"./readerConfig\";\r\n\r\nexport const MouseEvent = (epub, key) => {\r\n  let isFirefox = navigator.userAgent.indexOf(\"Firefox\") !== -1;\r\n  let lock = false; // 暂时锁住翻页快捷键，避免快速点击产生的Bug\r\n\r\n  let arrowKeys = event => {\r\n    event.preventDefault();\r\n\r\n    if (lock) return;\r\n\r\n    if (event.keyCode === 37 || event.keyCode === 38) {\r\n      epub.prevPage();\r\n      lock = true;\r\n      setTimeout(function() {\r\n        lock = false;\r\n      }, 100);\r\n      return false;\r\n    }\r\n\r\n    if (event.keyCode === 39 || event.keyCode === 40) {\r\n      epub.nextPage();\r\n      lock = true;\r\n      setTimeout(function() {\r\n        lock = false;\r\n      }, 100);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  let mouseFirefox = event => {\r\n    event.preventDefault();\r\n\r\n    if (lock) return;\r\n\r\n    if (event.detail < 0) {\r\n      epub.prevPage();\r\n      lock = true;\r\n      setTimeout(function() {\r\n        lock = false;\r\n      }, 100);\r\n      return false;\r\n    }\r\n\r\n    if (event.detail > 0) {\r\n      epub.nextPage();\r\n      lock = true;\r\n      setTimeout(function() {\r\n        lock = false;\r\n      }, 100);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  let mouseChrome = event => {\r\n    // event.preventDefault();\r\n    console.log(\"wheel moving\");\r\n    if (lock) return;\r\n\r\n    if (event.wheelDelta > 0) {\r\n      epub.prevPage();\r\n      lock = true;\r\n      setTimeout(function() {\r\n        lock = false;\r\n      }, 100);\r\n      return false;\r\n    }\r\n\r\n    if (event.wheelDelta < 0) {\r\n      epub.nextPage();\r\n      lock = true;\r\n      setTimeout(function() {\r\n        lock = false;\r\n      }, 100);\r\n      return false;\r\n    }\r\n  };\r\n  // let recordCfi = () => {\r\n  //   let cfi = epub.getCurrentLocationCfi();\r\n  //   let locations = epub.locations;\r\n  //   let percentage = locations.percentageFromCfi(cfi);\r\n  //   // console.log(percentage, \"sahafhfh\");\r\n  //   console.log(percentage, \"dgafhdafha\");\r\n  //   AutoBookmark.recordCfi(key, cfi, percentage);\r\n  // };\r\n  let copyText = event => {\r\n    let key = event.keyCode || event.which;\r\n    if (key === 67 && event.ctrlKey) {\r\n      let iDoc = document.getElementsByTagName(\"iframe\")[0].contentDocument;\r\n      let text = iDoc.execCommand(\"copy\", false, null);\r\n      !text\r\n        ? console.log(\"failed to copy text to clipboard\")\r\n        : console.log(`copied!`);\r\n    }\r\n  };\r\n\r\n  epub.on(\"renderer:chapterDisplayed\", () => {\r\n    // console.log(\r\n    //   \"%c renderer:chapterDisplayed has been triggered! \",\r\n    //   \"color: cyan; background: #333333\"\r\n    // );\r\n\r\n    let doc = epub.renderer.doc;\r\n\r\n    // doc.addEventListener(\"click\", openMenu); // 为每一章节内容绑定弹出菜单触发程序\r\n    doc.addEventListener(\"keydown\", arrowKeys, false); // 箭头按键翻页\r\n    doc.addEventListener(\"keydown\", copyText); // 解决 Ctrl + C 复制的bug\r\n\r\n    // 鼠标滚轮翻页\r\n    // console.log(\"wheel moving\");\r\n    if (isFirefox) doc.addEventListener(\"DOMMouseScroll\", mouseFirefox, false);\r\n    else {\r\n      doc.addEventListener(\"mousewheel\", mouseChrome, false);\r\n      // doc.addEventListener(\"mousewheel\", recordCfi, false);\r\n    }\r\n    // let viewArea = document.querySelector(\".view-area-page\");\r\n    // viewArea.setAttribute(\r\n    //   \"style\",\r\n    //   `left: ${ReaderConfig.get().padding}px; right:${\r\n    //     ReaderConfig.get().padding\r\n    //   }px; top:${ReaderConfig.get().padding}px; bottom:${\r\n    //     ReaderConfig.get().padding\r\n    //   }px`\r\n    // );\r\n    StyleConfig.addDefaultCss(); // 切换章节后为当前文档设置默认的样式\r\n    // console.log(\"我被执行能力\");\r\n    StyleConfig.applyCss(); // 切换章节后应当为当前文档设置样式\r\n  });\r\n};\r\n","import React, { Component } from \"react\";\r\nimport \"./viewArea.css\";\r\nimport { connect } from \"react-redux\";\r\nimport PopupMenu from \"../popupMenu/popupMenu\";\r\nimport ViewPage from \"../../components/viewPage/viewPage\";\r\nclass ViewArea extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isSingle: \"double\" };\r\n  }\r\n\r\n  // 翻页：上一页\r\n  prev() {\r\n    this.props.epub.prevPage();\r\n    this.closeMenu();\r\n    this.closeNoteCard();\r\n  }\r\n\r\n  // 翻页：下一页\r\n  next() {\r\n    this.props.epub.nextPage();\r\n    this.closeMenu();\r\n    this.closeNoteCard();\r\n  }\r\n\r\n  render() {\r\n    console.log(this.state.isSingle);\r\n    return (\r\n      <div className=\"view-area\">\r\n        <PopupMenu id=\"popup-menu\" />\r\n        <ViewPage />\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    isSingle: state.reader.isSingle\r\n  };\r\n};\r\nconst actionCreator = {};\r\nViewArea = connect(mapStateToProps, actionCreator)(ViewArea);\r\nexport default ViewArea;\r\n","import React, { Component } from \"react\";\r\nimport \"./background.css\";\r\nimport { connect } from \"react-redux\";\r\nclass Background extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isSingle: localStorage.getItem(\"isSingle\") || \"double\"\r\n    };\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"background\">\r\n        <div className=\"background-box1\"></div>\r\n        <div className=\"background-box2\"></div>\r\n        <div className=\"background-box3\">\r\n          <div\r\n            className=\"spine-shadow-left\"\r\n            style={this.state.isSingle === \"single\" ? { display: \"none\" } : {}}\r\n          >\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              width=\"68\"\r\n              height=\"800\"\r\n              viewBox=\"0 0 68 800\"\r\n            >\r\n              <defs>\r\n                <linearGradient\r\n                  id=\"linear-gradient\"\r\n                  x1=\"0.5\"\r\n                  x2=\"0.5\"\r\n                  y2=\"1\"\r\n                  gradientUnits=\"objectBoundingBox\"\r\n                >\r\n                  <stop offset=\"0\" stopColor=\"#fff\" stopOpacity=\"0\" />\r\n                  <stop offset=\"1\" stopColor=\"gray\" stopOpacity=\"0.388\" />\r\n                </linearGradient>\r\n              </defs>\r\n              <rect\r\n                width=\"800\"\r\n                height=\"68\"\r\n                transform=\"translate(0 800) rotate(-90)\"\r\n              />\r\n            </svg>\r\n          </div>\r\n          <div\r\n            className=\"book-spine\"\r\n            style={this.state.isSingle === \"single\" ? { display: \"none\" } : {}}\r\n          ></div>\r\n          <div\r\n            className=\"spine-shadow-right\"\r\n            style={this.state.isSingle === \"single\" ? { display: \"none\" } : {}}\r\n          >\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              width=\"68\"\r\n              height=\"800\"\r\n              viewBox=\"0 0 68 800\"\r\n            >\r\n              <defs>\r\n                <linearGradient\r\n                  id=\"linear-gradient\"\r\n                  x1=\"0.5\"\r\n                  x2=\"0.5\"\r\n                  y2=\"1\"\r\n                  gradientUnits=\"objectBoundingBox\"\r\n                >\r\n                  <stop offset=\"0\" stopColor=\"#fff\" stopOpacity=\"0\" />\r\n                  <stop offset=\"1\" stopColor=\"gray\" stopOpacity=\"0.388\" />\r\n                </linearGradient>\r\n              </defs>\r\n              <rect\r\n                width=\"800\"\r\n                height=\"68\"\r\n                transform=\"translate(68) rotate(90)\"\r\n              />\r\n            </svg>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    isSingle: state.reader.isSingle\r\n  };\r\n};\r\nconst actionCreator = {};\r\nBackground = connect(mapStateToProps, actionCreator)(Background);\r\nexport default Background;\r\n","import React, { Component } from \"react\";\r\nimport { themeList } from \"../../utils/readerConfig\";\r\nimport ReaderConfig from \"../../utils/readerConfig\";\r\nimport StyleConfig from \"../../utils/styleConfig\";\r\nimport \"./themeList.css\";\r\nimport { connect } from \"react-redux\";\r\nclass ThemeList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      currentBackgroundIndex: themeList.findIndex(item => {\r\n        return item.theme === this.props.theme;\r\n      })\r\n    };\r\n  }\r\n  handleChangeColor(theme, index) {\r\n    ReaderConfig.set(\"theme\", theme);\r\n    this.setState({\r\n      currentBackgroundIndex: index\r\n    });\r\n    StyleConfig.addDefaultCss();\r\n  }\r\n  render() {\r\n    const renderBackgroundColorList = () => {\r\n      return themeList.map((item, index) => {\r\n        return (\r\n          <li\r\n            key={item.id}\r\n            className={\r\n              index === this.state.currentBackgroundIndex\r\n                ? \"active-color background-color-circle\"\r\n                : \"background-color-circle\"\r\n            }\r\n            onClick={() => {\r\n              this.handleChangeColor(item.theme, index);\r\n            }}\r\n            style={{ backgroundColor: item.theme }}\r\n          ></li>\r\n        );\r\n      });\r\n    };\r\n    return (\r\n      <div className=\"background-color-setting\">\r\n        <div className=\"background-color-text\">背景颜色</div>\r\n        <ul className=\"background-color-list\">{renderBackgroundColorList()}</ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { theme: state.settingPanel.theme };\r\n};\r\nconst actionCreator = {};\r\nThemeList = connect(mapStateToProps, actionCreator)(ThemeList);\r\nexport default ThemeList;\r\n","import React, { Component } from \"react\";\r\nimport { fontSizeList } from \"../../utils/readerConfig\";\r\nimport ReaderConfig from \"../../utils/readerConfig\";\r\nimport StyleConfig from \"../../utils/styleConfig\";\r\nimport { connect } from \"react-redux\";\r\n\r\nimport \"./fontSizeList.css\";\r\n// @connect(state => state.settingPanel)\r\nclass FontSizeList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      currentFontSizeIndex: fontSizeList.findIndex(item => {\r\n        return item.num === this.props.fontSize;\r\n      })\r\n    };\r\n  }\r\n\r\n  handleFontSize(num, index) {\r\n    ReaderConfig.set(\"fontSize\", num);\r\n    this.setState({\r\n      currentFontSizeIndex: index\r\n    });\r\n    StyleConfig.addDefaultCss();\r\n  }\r\n\r\n  render() {\r\n    const renderFontSizeDescription = () => {\r\n      return fontSizeList.map((item, index) => {\r\n        // console.log(index, this.state.currentFontSizeIndex);\r\n        return (\r\n          <li className=\"font-size-description\" key={item.id}>\r\n            <div\r\n              className={\r\n                index === this.state.currentFontSizeIndex\r\n                  ? \"active-font-size font-size-circle\"\r\n                  : \"font-size-circle\"\r\n              }\r\n              onClick={() => this.handleFontSize(item.num, index)}\r\n            ></div>\r\n            <p className=\"font-size-text\">{item.size}</p>\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n    return (\r\n      <div className=\"font-size-setting\">\r\n        <div className=\"font-size-title\">字号大小</div>\r\n        <span className=\"ultra-small-size\">A</span>\r\n        <div className=\"font-size-line\"></div>\r\n        <ul className=\"font-size-selector\">{renderFontSizeDescription()}</ul>\r\n\r\n        <span className=\"ultra-large-size\">A</span>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { fontSize: state.settingPanel.fontSize };\r\n};\r\nconst actionCreator = {};\r\nFontSizeList = connect(mapStateToProps, actionCreator)(FontSizeList);\r\nexport default FontSizeList;\r\n","import React, { Component } from \"react\";\r\nimport ReaderConfig from \"../../utils/readerConfig\";\r\nimport StyleConfig from \"../../utils/styleConfig\";\r\nimport { dropdownList } from \"../../utils/readerConfig\";\r\nimport { connect } from \"react-redux\";\r\nimport \"./dropdownList.css\";\r\n// @connect(state => state.settingPanel)\r\nclass DropdownList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      currentFontFamilyIndex: dropdownList[0].option.findIndex(item => {\r\n        return item.value === this.props.fontFamily;\r\n      }),\r\n\r\n      currentLineHeightIndex: dropdownList[1].option.findIndex(item => {\r\n        console.log(item.value, this.props.lineHeight, \"adhsdjgh\");\r\n        return item.value === parseFloat(this.props.lineHeight);\r\n      }),\r\n      currentPaddingIndex: dropdownList[2].option.findIndex(item => {\r\n        return item.value === parseInt(this.props.padding);\r\n      })\r\n    };\r\n  }\r\n  componentDidMount() {\r\n    document\r\n      .querySelector(\".paragraph-character-setting\")\r\n      .children[0].children[1].children[\r\n        this.state.currentFontFamilyIndex\r\n      ].setAttribute(\"selected\", \"selected\");\r\n\r\n    document\r\n      .querySelector(\".paragraph-character-setting\")\r\n      .children[1].children[1].children[\r\n        this.state.currentLineHeightIndex\r\n      ].setAttribute(\"selected\", \"selected\");\r\n    document\r\n      .querySelector(\".paragraph-character-setting\")\r\n      .children[2].children[1].children[\r\n        this.state.currentPaddingIndex\r\n      ].setAttribute(\"selected\", \"selected\");\r\n  }\r\n  handleView(event, option) {\r\n    // console.log(value, \"value\");\r\n    let arr = event.target.value.split(\",\");\r\n    // console.log(arr);\r\n    // console.log(typeof event.target.value, \"fgafhh\");\r\n    ReaderConfig.set(option, arr[0]);\r\n    console.log(option, arr[0], \"sasfhfshg\");\r\n    switch (option) {\r\n      case \"font\":\r\n        this.setState({\r\n          currentFontIndex: arr[1]\r\n        });\r\n        break;\r\n      case \"fontWeight\":\r\n        this.setState({\r\n          currentFontWeightIndex: arr[1]\r\n        });\r\n        break;\r\n      case \"lineHeight\":\r\n        this.setState({\r\n          currentLineHeightIndex: arr[1]\r\n        });\r\n        break;\r\n      case \"padding\":\r\n        this.setState({\r\n          currentPaddingIndex: arr[1]\r\n        });\r\n        break;\r\n      case \"wordSpacing\":\r\n        this.setState({\r\n          currentWordSpacingIndex: arr[1]\r\n        });\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    StyleConfig.addDefaultCss();\r\n  }\r\n  render() {\r\n    const renderParagraphCharacter = () => {\r\n      return dropdownList.map((item, index) => (\r\n        <li className=\"paragraph-character-container\" key={item.id}>\r\n          <p className=\"general-setting-title\">{item.title}</p>\r\n          <select\r\n            name=\"\"\r\n            className=\"general-setting-dropdown\"\r\n            onChange={event => {\r\n              this.handleView(event, item.value);\r\n            }}\r\n          >\r\n            {item.option.map((item, index) => (\r\n              <option\r\n                value={[item.value, index]}\r\n                className=\"general-setting-option\"\r\n                key={item.id}\r\n              >\r\n                {item.name}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </li>\r\n      ));\r\n    };\r\n\r\n    return (\r\n      <ul className=\"paragraph-character-setting\">\r\n        {renderParagraphCharacter()}\r\n      </ul>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    fontFamily: state.settingPanel.fontFamily,\r\n    lineHeight: state.settingPanel.lineHeight,\r\n    padding: state.settingPanel.padding\r\n  };\r\n};\r\nconst actionCreator = {};\r\nDropdownList = connect(mapStateToProps, actionCreator)(DropdownList);\r\nexport default DropdownList;\r\n","import localforage from \"localforage\";\r\nconst initState = {\r\n  bookmarks: null,\r\n  notes: null,\r\n  digests: null,\r\n  locations: null,\r\n  chapters: null,\r\n  highlighters: null,\r\n  isSingle: localStorage.getItem(\"isSingle\") || \"double\"\r\n};\r\nexport function reader(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"HANDLE_BOOKMARKS\":\r\n      return {\r\n        ...state,\r\n        bookmarks: action.payload\r\n      };\r\n    case \"HANDLE_NOTES\":\r\n      return {\r\n        ...state,\r\n        notes: action.payload\r\n      };\r\n    case \"HANDLE_DIGESTS\":\r\n      return {\r\n        ...state,\r\n        digests: action.payload\r\n      };\r\n    case \"HANDLE_LOCATIONS\":\r\n      return {\r\n        ...state,\r\n        locations: action.payload\r\n      };\r\n    case \"HANDLE_SECTION\":\r\n      return {\r\n        ...state,\r\n        section: action.payload\r\n      };\r\n    case \"HANDLE_SINGLE\":\r\n      return {\r\n        ...state,\r\n        isSingle: action.payload\r\n      };\r\n    case \"HANDLE_CHAPTERS\":\r\n      return {\r\n        ...state,\r\n        chapters: action.payload\r\n      };\r\n    case \"HANDLE_HIGHLIGHTERS\":\r\n      return {\r\n        ...state,\r\n        highlighters: action.payload\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\nexport function handleNotes(notes) {\r\n  return { type: \"HANDLE_NOTES\", payload: notes };\r\n}\r\nexport function handleBookmarks(bookmarks) {\r\n  // console.log(bookmarks, \"bookmarks\");\r\n  return { type: \"HANDLE_BOOKMARKS\", payload: bookmarks };\r\n}\r\nexport function handleDigests(digests) {\r\n  return { type: \"HANDLE_DIGESTS\", payload: digests };\r\n}\r\nexport function handleLocations(locations) {\r\n  return { type: \"HANDLE_LOCATIONS\", payload: locations };\r\n}\r\nexport function handleSection(section) {\r\n  return { type: \"HANDLE_SECTION\", payload: section };\r\n}\r\nexport function handleSingle(mode) {\r\n  return { type: \"HANDLE_SINGLE\", payload: mode };\r\n}\r\nexport function handleChapters(chapters) {\r\n  return { type: \"HANDLE_CHAPTERS\", payload: chapters };\r\n}\r\nexport function handleHighlighters(highlighters) {\r\n  return { type: \"HANDLE_HIGHLIGHTERS\", payload: highlighters };\r\n}\r\nexport function handleFetchNotes() {\r\n  return dispatch => {\r\n    localforage.getItem(\"notes\", (err, value) => {\r\n      let noteArr;\r\n      if (value === null || value === []) {\r\n        noteArr = null;\r\n      } else {\r\n        noteArr = value;\r\n      }\r\n      // console.log(\"hellosdhf\");\r\n      dispatch(handleNotes(noteArr));\r\n    });\r\n  };\r\n}\r\n\r\nexport function handleFetchChapters(epub) {\r\n  return dispatch => {\r\n    // console.log(value, \"dgaskgskgr\");\r\n    epub.getToc().then(chapters => {\r\n      // console.log(chapters, \"asfhdgh\");\r\n      dispatch(handleChapters(chapters));\r\n      // console.log(this.state.chapters);\r\n    });\r\n  };\r\n}\r\nexport function handleFetchBookmarks() {\r\n  return dispatch => {\r\n    localforage.getItem(\"bookmarks\", (err, value) => {\r\n      let bookmarkArr;\r\n      if (value === null || value === []) {\r\n        bookmarkArr = null;\r\n      } else {\r\n        bookmarkArr = value;\r\n      }\r\n      // console.log(value, \"dgaskgskgr\");\r\n      dispatch(handleBookmarks(bookmarkArr));\r\n    });\r\n  };\r\n}\r\nexport function handleFetchDigests() {\r\n  return dispatch => {\r\n    localforage.getItem(\"digests\", (err, value) => {\r\n      let digestArr;\r\n      if (value === null || value === []) {\r\n        digestArr = null;\r\n      } else {\r\n        digestArr = value;\r\n      }\r\n      // console.log(digestArr);\r\n      dispatch(handleDigests(digestArr));\r\n    });\r\n  };\r\n}\r\nexport function handleFetchHighlighters() {\r\n  return dispatch => {\r\n    localforage.getItem(\"highlighters\", (err, value) => {\r\n      let highlighterArr;\r\n      if (value === null || value === []) {\r\n        highlighterArr = null;\r\n      } else {\r\n        highlighterArr = value;\r\n      }\r\n      dispatch(handleHighlighters(highlighterArr));\r\n    });\r\n  };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"./singleControl.css\";\r\nimport { handleSingle } from \"../../redux/reader.redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { handleMessageBox, handleMessage } from \"../../redux/manager.redux\";\r\nclass SingleControl extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isSingle: localStorage.getItem(\"isSingle\") || \"double\" };\r\n  }\r\n  UNSAFE_componentWillMount() {\r\n    console.log(this.state.isSingle);\r\n  }\r\n\r\n  handleClick = mode => {\r\n    console.log(mode, \"sadfsahgj\");\r\n    this.props.handleSingle(mode);\r\n    this.setState({ isSingle: mode });\r\n    localStorage.setItem(\"isSingle\", mode);\r\n    this.props.handleMessage(\"退出后生效\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  render() {\r\n    console.log(this.state.isSingle);\r\n    return (\r\n      <div className=\"single-control-container\">\r\n        <div\r\n          className=\"single-mode-container\"\r\n          onClick={() => {\r\n            this.handleClick(\"single\");\r\n          }}\r\n          style={this.state.isSingle === \"double\" ? { opacity: 0.4 } : {}}\r\n        >\r\n          <span className=\"icon-single-page single-page-icon\"></span>\r\n          <div className=\"single-mode-text\">单页模式</div>\r\n        </div>\r\n        <div\r\n          className=\"double-mode-container\"\r\n          onClick={() => {\r\n            this.handleClick(\"double\");\r\n          }}\r\n          style={this.state.isSingle === \"single\" ? { opacity: 0.4 } : {}}\r\n        >\r\n          <span className=\"icon-two-page two-page-icon\"></span>\r\n          <div className=\"double-mode-text\">双页模式</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { isSingle: state.reader.isSingle };\r\n};\r\nconst actionCreator = { handleSingle, handleMessageBox, handleMessage };\r\nSingleControl = connect(mapStateToProps, actionCreator)(SingleControl);\r\nexport default SingleControl;\r\n","import React, { Component } from \"react\";\r\nimport \"./settingPanel.css\";\r\nimport { connect } from \"react-redux\";\r\nimport ThemeList from \"../themeList/themeList\";\r\nimport FontSizeList from \"../fontSizeList/fontSizeList\";\r\nimport DropdownList from \"../dropdownList/dropdownList\";\r\nimport SingleControl from \"../singleControl/singleControl\";\r\nclass SettingPanel extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n  }\r\n\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"setting-panel\">\r\n        <div className=\"setting-panel-title\">阅读选项</div>\r\n        <SingleControl />\r\n        <ThemeList />\r\n        <FontSizeList />\r\n        <DropdownList />\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { books: state.manager.books };\r\n};\r\nconst actionCreator = {};\r\nSettingPanel = connect(mapStateToProps, actionCreator)(SettingPanel);\r\nexport default SettingPanel;\r\n","import React, { Component } from \"react\";\r\nimport \"./contentList.css\";\r\nimport { connect } from \"react-redux\";\r\nclass ContentList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { chapters: [] };\r\n    this.handleJump = this.handleJump.bind(this);\r\n  }\r\n  componentWillMount() {\r\n    this.props.currentEpub.getToc().then(chapters => {\r\n      this.setState({ chapters });\r\n      // console.log(this.state.chapters);\r\n    });\r\n  }\r\n  handleJump(event) {\r\n    let href = event.target.getAttribute(\"href\");\r\n    console.log(this.props.currentEpub, href, \"sfhfdhdfhf\");\r\n    this.props.currentEpub.goto(href);\r\n    event.preventDefault();\r\n    // console.log(\"fdhadfhgdgdj\");\r\n  }\r\n  render() {\r\n    // console.log(this.state.chapters, \"fhdfhahh\");\r\n    const renderContentList = () => {\r\n      return this.state.chapters.map((item, index) => {\r\n        // let href = \"/#/reader/\" + item.href;\r\n        let isSubContentList = item.subitems && item.subitems.length;\r\n        const renderSubContentList = () => {\r\n          return item.subitems.map((item, index) => {\r\n            return (\r\n              <li key={index} className=\"book-subcontent-list\">\r\n                <a\r\n                  href={item.href}\r\n                  onClick={this.handleJump}\r\n                  className=\"book-subcontent-name\"\r\n                >\r\n                  {item.label}\r\n                </a>\r\n              </li>\r\n            );\r\n          });\r\n        };\r\n        return (\r\n          <li className=\"book-content-list\" key={index}>\r\n            <a\r\n              href={item.href}\r\n              onClick={this.handleJump}\r\n              className=\"book-content-name\"\r\n            >\r\n              {item.label}\r\n            </a>\r\n            {isSubContentList ? <ul>{renderSubContentList()}</ul> : null}\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n\r\n    return (\r\n      <div className=\"book-content-container\">\r\n        <ul className=\"book-content\">{renderContentList()}</ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { currentEpub: state.book.currentEpub };\r\n};\r\nconst actionCreator = {};\r\nContentList = connect(mapStateToProps, actionCreator)(ContentList);\r\nexport default ContentList;\r\n","import React, { Component } from \"react\";\r\nimport \"./bookmarkList.css\";\r\nimport { connect } from \"react-redux\";\r\nclass BookmarkList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { bookmarks: this.props.bookmarks };\r\n  }\r\n  static getDerivedStateFromProps(nextProps, prevState) {\r\n    // console.log(\"nextProps\", nextProps, \"\\nprevState\", prevState);\r\n    if (nextProps.bookmarks !== prevState.bookmarks)\r\n      return { bookmarks: nextProps.bookmarks };\r\n    else return null;\r\n  }\r\n  componenetDidMount() {\r\n    setInterval(() => {\r\n      console.log(this.props.state);\r\n    }, 1000);\r\n  }\r\n  handleJump(cfi) {\r\n    console.log(cfi, \"afhahhhh\");\r\n    this.props.currentEpub.gotoCfi(cfi);\r\n  }\r\n  render() {\r\n    console.log(this.props.bookmarks, \"bookmarkks\");\r\n    const renderBookmarkList = () => {\r\n      let { bookmarks } = this.state;\r\n      console.log(bookmarks);\r\n      return bookmarks\r\n        .filter(item => {\r\n          return item.bookKey === this.props.currentBook.key;\r\n        })\r\n        .map(item => {\r\n          return (\r\n            <li className=\"book-bookmark-list\" key={item.key}>\r\n              <p className=\"book-bookmark-digest\">{item.label}</p>\r\n              <span className=\"book-bookmark-index\">{item.chapter}</span>\r\n              <div className=\"book-bookmark-progress\">\r\n                {Math.floor(item.percentage * 100)}%\r\n              </div>\r\n              <div\r\n                className=\"book-bookmark-link\"\r\n                onClick={() => {\r\n                  this.handleJump(item.cfi);\r\n                }}\r\n                style={{ cursor: \"pointer\" }}\r\n              >\r\n                点击跳转\r\n              </div>\r\n            </li>\r\n          );\r\n        });\r\n    };\r\n    return (\r\n      <div className=\"book-bookmark-container\">\r\n        <ul className=\"book-bookmark\">{renderBookmarkList()}</ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    state: state,\r\n    currentBook: state.book.currentBook,\r\n    currentEpub: state.book.currentEpub,\r\n    bookmarks: state.reader.bookmarks\r\n  };\r\n};\r\nconst actionCreator = {};\r\nBookmarkList = connect(mapStateToProps, actionCreator)(BookmarkList);\r\nexport default BookmarkList;\r\n","// 记录书本打开记录\r\nclass ReadingTime {\r\n  static setTime(bookKey, time) {\r\n    let json = localStorage.getItem(\"readingTime\");\r\n    let obj = JSON.parse(json) || {};\r\n\r\n    // let openTime = new Date().getTime();\r\n    obj[bookKey] = time;\r\n    // console.log(cfi, \"dfhdafhdfh\");\r\n    localStorage.setItem(\"readingTime\", JSON.stringify(obj));\r\n  }\r\n\r\n  static getTime(bookKey) {\r\n    let json = localStorage.getItem(\"readingTime\");\r\n    let obj = JSON.parse(json) || {};\r\n\r\n    return obj[bookKey] || 0;\r\n  }\r\n  static clearTime(bookKey) {\r\n    let json = localStorage.getItem(\"readingTime\");\r\n    let obj = JSON.parse(json) || {};\r\n    delete obj[bookKey];\r\n\r\n    localStorage.setItem(\"readingTime\", JSON.stringify(obj));\r\n  }\r\n}\r\n\r\nexport default ReadingTime;\r\n","import React, { Component } from \"react\";\r\nimport \"./navigationPanel.css\";\r\nimport { connect } from \"react-redux\";\r\nimport ContentList from \"../contentList/contentList\";\r\nimport BookmarkList from \"../bookmarkList/boomarkList\";\r\nimport { handleFetchBookmarks } from \"../../redux/reader.redux\";\r\nimport ReadingTime from \"../../utils/readingTime\";\r\nclass NavigationPanel extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isContentShow: true,\r\n      chapters: [],\r\n      cover: \"\",\r\n      searchList: null,\r\n      time: ReadingTime.getTime(this.props.currentBook.key)\r\n    };\r\n    this.timer = null;\r\n  }\r\n  componentDidMount() {\r\n    this.timer = setInterval(() => {\r\n      let time = this.state.time;\r\n      time += 1;\r\n      this.setState({ time });\r\n    }, 1000);\r\n    // console.log(this.props.currentBook.cover, \"fhadhgdah\");\r\n    this.props.currentEpub.coverUrl().then(url => {\r\n      // console.log(url, \"url\");\r\n      this.setState({ cover: url });\r\n    });\r\n    this.props.handleFetchBookmarks();\r\n  }\r\n  componentWillUnmount() {\r\n    clearInterval(this.timer);\r\n    ReadingTime.setTime(this.props.currentBook.key, this.state.time);\r\n  }\r\n\r\n  handleClick = state => {\r\n    this.setState({ isContentShow: state });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"navigation-panel\">\r\n        <div className=\"navigation-header\">\r\n          <img className=\"book-cover\" src={this.state.cover} alt=\"\" />\r\n          <div className=\"book-title-container\">\r\n            <p className=\"book-title\">{this.props.currentBook.name}</p>\r\n          </div>\r\n\r\n          <p className=\"book-arthur\">\r\n            作者:{\" \"}\r\n            {this.props.currentBook.arthur\r\n              ? this.props.currentBook.arthur\r\n              : \"未知\"}\r\n          </p>\r\n          <span className=\"reading-duration\">\r\n            已读: {Math.floor(this.state.time / 60)}分钟\r\n          </span>\r\n\r\n          <div className=\"navigation-navigation\">\r\n            <span\r\n              className=\"book-content-title\"\r\n              onClick={() => {\r\n                this.handleClick(true);\r\n              }}\r\n              style={\r\n                this.state.isContentShow\r\n                  ? { color: \"rgba(112, 112, 112, 1)\" }\r\n                  : { color: \"rgba(217, 217, 217, 1)\" }\r\n              }\r\n            >\r\n              目录\r\n            </span>\r\n            <span\r\n              className=\"book-bookmark-title\"\r\n              style={\r\n                this.state.isContentShow\r\n                  ? { color: \"rgba(217, 217, 217, 1)\" }\r\n                  : { color: \"rgba(112, 112, 112, 1)\" }\r\n              }\r\n              onClick={() => {\r\n                this.handleClick(false);\r\n              }}\r\n            >\r\n              书签\r\n            </span>\r\n          </div>\r\n        </div>\r\n        <div className=\"navigation-body\">\r\n          {this.state.isContentShow ? <ContentList /> : <BookmarkList />}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    bookmarks: state.reader.bookmarks\r\n  };\r\n};\r\nconst actionCreator = { handleFetchBookmarks };\r\nNavigationPanel = connect(mapStateToProps, actionCreator)(NavigationPanel);\r\nexport default NavigationPanel;\r\n","class Bookmark {\r\n  constructor(bookKey, cfi, label, percentage, chapter) {\r\n    this.key = new Date().getTime() + \"\"; // 唯一的键\r\n    this.bookKey = bookKey; // 所属的书籍的键\r\n    this.cfi = cfi; // 标记阅读位置的cfi\r\n    this.label = label; // 此项书签的别名\r\n    this.percentage = percentage; // 此项书签的摘要\r\n    this.chapter = chapter; // 此项书签的摘要\r\n  }\r\n}\r\n\r\nexport default Bookmark;\r\n","const initState = {\r\n  isOpenEditDialog: false,\r\n  isOpenDeleteDialog: false,\r\n  isOpenAddDialog: false,\r\n  isReading: false,\r\n  currentBook: {},\r\n  currentEpub: {},\r\n  isRedirect: false\r\n  // cover:''\r\n};\r\nexport function book(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"HANDLE_EDIT_DIALOG\":\r\n      return {\r\n        ...state,\r\n        isOpenEditDialog: action.payload\r\n      };\r\n    case \"HANDLE_DELETE_DIALOG\":\r\n      return {\r\n        ...state,\r\n        isOpenDeleteDialog: action.payload\r\n      };\r\n    case \"HANDLE_ADD_DIALOG\":\r\n      return {\r\n        ...state,\r\n        isOpenAddDialog: action.payload\r\n      };\r\n    case \"HANDLE_READING_STATE\":\r\n      return {\r\n        ...state,\r\n        isReading: action.payload\r\n      };\r\n    case \"HANDLE_READING_BOOK\":\r\n      return {\r\n        ...state,\r\n        currentBook: action.payload\r\n      };\r\n\r\n    case \"HANDLE_READING_EPUB\":\r\n      return {\r\n        ...state,\r\n        currentEpub: action.payload\r\n      };\r\n    case \"HANDLE_REDIRECT\":\r\n      return {\r\n        ...state,\r\n        isRedirect: true\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport function handleEditDialog(mode) {\r\n  return { type: \"HANDLE_EDIT_DIALOG\", payload: mode };\r\n}\r\nexport function handleDeleteDialog(mode) {\r\n  return { type: \"HANDLE_DELETE_DIALOG\", payload: mode };\r\n}\r\nexport function handleAddDialog(mode) {\r\n  return { type: \"HANDLE_ADD_DIALOG\", payload: mode };\r\n}\r\nexport function handleReadingState(state) {\r\n  return { type: \"HANDLE_READING_STATE\", payload: state };\r\n}\r\nexport function handleReadingBook(book) {\r\n  return { type: \"HANDLE_READING_BOOK\", payload: book };\r\n}\r\nexport function handleReadingEpub(epub) {\r\n  return { type: \"HANDLE_READING_EPUB\", payload: epub };\r\n}\r\n\r\nexport function handleRedirect() {\r\n  return { type: \"HANDLE_REDIRECT\" };\r\n}\r\n","import React, { Component } from \"react\";\r\nimport \"./operationPanel.css\";\r\nimport Bookmark from \"../../model/Bookmark\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  handleBookmarks,\r\n  handleFetchBookmarks\r\n} from \"../../redux/reader.redux\";\r\nimport { handleMessageBox, handleMessage } from \"../../redux/manager.redux.js\";\r\nimport { handleReadingState } from \"../../redux/book.redux\";\r\nimport localforage from \"localforage\";\r\nimport RecordLocation from \"../../utils/recordLocation\";\r\nclass OperationPanel extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isFullScreen: false, // 是否进入全屏模式\r\n      isBookmark: false // 是否进入全屏模式\r\n    };\r\n  }\r\n\r\n  // 点击切换全屏按钮触发\r\n  handleScreen() {\r\n    !this.state.isFullScreen\r\n      ? this.handleFullScreen()\r\n      : this.handleExitFullScreen();\r\n  }\r\n  handleFullScreen() {\r\n    let de = document.documentElement;\r\n\r\n    if (de.requestFullscreen) {\r\n      de.requestFullscreen();\r\n    } else if (de.mozRequestFullScreen) {\r\n      de.mozRequestFullScreen();\r\n    } else if (de.webkitRequestFullscreen) {\r\n      de.webkitRequestFullscreen();\r\n    } else if (de.msRequestFullscreen) {\r\n      de.msRequestFullscreen();\r\n    }\r\n\r\n    this.setState({ isFullScreen: true });\r\n  }\r\n\r\n  // 退出全屏模式\r\n  handleExitFullScreen() {\r\n    if (document.exitFullscreen) {\r\n      document.exitFullscreen();\r\n    } else if (document.msExitFullscreen) {\r\n      document.msExitFullscreen();\r\n    } else if (document.mozCancelFullScreen) {\r\n      document.mozCancelFullScreen();\r\n    } else if (document.webkitExitFullscreen) {\r\n      document.webkitExitFullscreen();\r\n    }\r\n\r\n    this.setState({ isFullScreen: false });\r\n  }\r\n  handleAddBookmark() {\r\n    let bookKey = this.props.currentBook.key;\r\n    let epub = this.props.currentEpub;\r\n    let cfi =\r\n      RecordLocation.getCfi(this.props.currentBook.key) === null\r\n        ? 0\r\n        : RecordLocation.getCfi(this.props.currentBook.key).cfi;\r\n    let firstVisibleNode = epub.renderer.findFirstVisible();\r\n    let label = firstVisibleNode ? firstVisibleNode.textContent : \"\";\r\n    // console.log(label, \"asfhfhafh\");\r\n    label = label && label.trim();\r\n    label = label || cfi;\r\n    let percentage =\r\n      RecordLocation.getCfi(this.props.currentBook.key) === null\r\n        ? 0\r\n        : RecordLocation.getCfi(this.props.currentBook.key).percentage;\r\n    // console.log(this.props.chapters, this.props.currentEpub, \"dhdgadgjg\");\r\n    let index = this.props.chapters.findIndex(item => {\r\n      return item.spinePos > this.props.currentEpub.spinePos;\r\n    });\r\n    // console.log(index, \"sahathth\");\r\n    let chapter = \"未知章节\";\r\n    if (this.props.chapters[index] !== undefined) {\r\n      chapter = this.props.chapters[index].label.trim(\" \");\r\n    }\r\n    // console.log(label, \"ahahagh\");\r\n    let bookmark = new Bookmark(bookKey, cfi, label, percentage, chapter);\r\n    let bookmarkArr = this.props.bookmarks ? this.props.bookmarks : [];\r\n    // console.log(this.props.bookmarks, \"dhdhdfah\");\r\n    bookmarkArr.push(bookmark);\r\n    console.log(bookmarkArr, \"bookmarkArr\");\r\n    this.props.handleBookmarks(bookmarkArr);\r\n    localforage.setItem(\"bookmarks\", bookmarkArr);\r\n    // this.props.toggleMessage(true);\r\n    this.setState({ isBookmark: true });\r\n    this.props.handleMessage(\"添加成功\");\r\n    this.props.handleMessageBox(true);\r\n  }\r\n\r\n  // 点击退出按钮的处理程序\r\n  handleExit() {\r\n    this.props.handleReadingState(false);\r\n    let cfi = this.props.currentEpub.getCurrentLocationCfi();\r\n    let locations = this.props.currentEpub.locations;\r\n    let percentage = locations.percentageFromCfi(cfi);\r\n    RecordLocation.recordCfi(this.props.currentBook.key, cfi, percentage);\r\n  }\r\n\r\n  render() {\r\n    // console.log(this.props.state, \"shafhahah\");\r\n    return (\r\n      <div className=\"book-operation-panel\">\r\n        <div\r\n          className=\"exit-reading-button\"\r\n          onClick={() => {\r\n            this.handleExit();\r\n          }}\r\n        >\r\n          <span className=\"icon-exit exit-reading-icon\"></span>\r\n          <span className=\"exit-reading-text\">退出阅读</span>\r\n        </div>\r\n        <div\r\n          className=\"add-bookmark-button\"\r\n          onClick={() => {\r\n            this.handleAddBookmark();\r\n          }}\r\n        >\r\n          <span className=\"icon-add add-bookmark-icon\"></span>\r\n          {true ? (\r\n            <span className=\"add-bookmark-text\">添加书签</span>\r\n          ) : (\r\n            <span className=\"add-bookmark-text\">取消书签</span>\r\n          )}\r\n        </div>\r\n        <div\r\n          className=\"enter-fullscreen-button\"\r\n          onClick={() => {\r\n            this.handleScreen();\r\n          }}\r\n        >\r\n          <span className=\"icon-fullscreen enter-fullscreen-icon\"></span>\r\n          {!this.state.isFullScreen ? (\r\n            <span className=\"enter-fullscreen-text\">进入全屏</span>\r\n          ) : (\r\n            <span className=\"enter-fullscreen-text\">退出全屏</span>\r\n          )}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    state: state,\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    bookmarks: state.reader.bookmarks,\r\n    chapters: state.reader.chapters\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleBookmarks,\r\n  handleReadingState,\r\n  handleFetchBookmarks,\r\n  handleMessageBox,\r\n  handleMessage\r\n};\r\nOperationPanel = connect(mapStateToProps, actionCreator)(OperationPanel);\r\nexport default OperationPanel;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport \"./messageBox.css\";\r\nclass MessageBox extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { message: this.props.message };\r\n  }\r\n  UNSAFE_componentWillReceiveProps(nextProps) {\r\n    this.setState({ message: nextProps.message });\r\n  }\r\n  render() {\r\n    return (\r\n      <div className=\"message-box-container\">\r\n        <span className=\"icon-message  message-box-icon\"></span>\r\n        <div className=\"message-content\">{this.state.message}</div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    message: state.manager.message\r\n  };\r\n};\r\nconst actionCreator = {};\r\nMessageBox = connect(mapStateToProps, actionCreator)(MessageBox);\r\nexport default MessageBox;\r\n","import React, { Component } from \"react\";\r\nimport \"./progressPanel.css\";\r\nimport { connect } from \"react-redux\";\r\nimport RecordLocation from \"../../utils/recordLocation\";\r\nimport {\r\n  // handleFetchPercentage,\r\n  handleFetchLocations\r\n} from \"../../redux/progressPanel.redux\";\r\n// @connect(state => state.book)\r\n// @connect(state => state.reader)\r\nclass ProgressPanel extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      displayPercentage:\r\n        this.props.percentage !== undefined ? this.props.percentage : 0\r\n    };\r\n  }\r\n  //WARNING! To be deprecated in React v17. Use componentDidMount instead.\r\n  UNSAFE_componentWillMount() {\r\n    // this.setState({\r\n    //   displayPercentage: this.props.percentage\r\n    // });\r\n    this.props.handleFetchLocations(this.props.currentEpub);\r\n  }\r\n  onProgressChange = event => {\r\n    const percentage = event.target.value / 100;\r\n    // console.log(this.state.locations, \"agashaf\");\r\n    const location =\r\n      percentage >= 0 ? this.props.locations.cfiFromPercentage(percentage) : 0;\r\n    // let progress = this.state.locations.percentageFromCfi(location);\r\n    // console.log(location, percentage, \"fhasfhfdh\");\r\n    this.props.currentEpub.gotoCfi(location);\r\n    // this.recordCfi();\r\n  };\r\n  //使进度百分比随拖动实时变化\r\n  onProgressInput = event => {\r\n    this.setState({ displayPercentage: event.target.value / 100 });\r\n    console.log(this.state.displayPercentage, \"kgdkdk\");\r\n  };\r\n  previourChapter = () => {\r\n    let currentSection = this.props.currentEpub.spinePos;\r\n    this.props.currentEpub.displayChapter(currentSection - 1, false);\r\n    let percentage =\r\n      RecordLocation.getCfi(this.props.currentBook.key) === null\r\n        ? 0\r\n        : RecordLocation.getCfi(this.props.currentBook.key).percentage;\r\n    console.log(percentage, \"sfhfhg\");\r\n    // this.props.handleFetchPercentage(this.props.currentBook);\r\n    this.setState({ displayPercentage: percentage });\r\n  };\r\n  nextChapter = () => {\r\n    let currentSection = this.props.currentEpub.spinePos;\r\n    this.props.currentEpub.displayChapter(currentSection + 1, false);\r\n    let percentage =\r\n      RecordLocation.getCfi(this.props.currentBook.key) === null\r\n        ? 0\r\n        : RecordLocation.getCfi(this.props.currentBook.key).percentage;\r\n    console.log(percentage, \"sfhfhg\");\r\n    // this.props.handleFetchPercentage(this.props.currentBook);\r\n    this.setState({ displayPercentage: percentage });\r\n  };\r\n\r\n  render() {\r\n    console.log(this.state.displayPercentage, \"sfhfsah\");\r\n    return (\r\n      <div className=\"progress-panel\">\r\n        <p className=\"progress-text\">\r\n          当前进度:\r\n          {Math.round(this.state.displayPercentage * 100)}%\r\n        </p>\r\n\r\n        <input\r\n          className=\"input-progress\"\r\n          defaultValue={Math.round(this.state.displayPercentage * 100)}\r\n          type=\"range\"\r\n          max=\"100\"\r\n          min=\"0\"\r\n          step=\"1\"\r\n          onMouseUp={event => {\r\n            this.onProgressChange(event);\r\n          }}\r\n          // onMouseDown={this.handleDrag()}\r\n          onChange={event => {\r\n            this.onProgressInput(event);\r\n          }}\r\n        />\r\n\r\n        <div\r\n          className=\"previous-chapter\"\r\n          onClick={() => {\r\n            this.previourChapter();\r\n          }}\r\n        >\r\n          <span className=\"icon-dropdown previous-chapter-icon\"> </span>\r\n        </div>\r\n        <div\r\n          className=\"next-chapter\"\r\n          onClick={() => {\r\n            this.nextChapter();\r\n          }}\r\n        >\r\n          <span className=\"icon-dropdown next-chapter-icon\"></span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    // state: state,\r\n\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    percentage: state.progressPanel.percentage,\r\n    locations: state.progressPanel.locations,\r\n    section: state.progressPanel.section\r\n  };\r\n};\r\nconst actionCreator = { handleFetchLocations };\r\nProgressPanel = connect(mapStateToProps, actionCreator)(ProgressPanel);\r\nexport default ProgressPanel;\r\n","import React, { Component } from \"react\";\r\n// import styleConfig from \"../../utils/styleConfig\";\r\nimport ViewArea from \"../../components/viewArea/viewArea\";\r\nimport Background from \"../../components/background/background\";\r\nimport SettingPanel from \"../../components/settingPanel/settingPanel\";\r\nimport NavigationPanel from \"../../components/navigationPanel/navigationPanel\";\r\nimport OperationPanel from \"../../components/operationPanel/operationPanel\";\r\nimport MessageBox from \"../../components/messageBox/messageBox\";\r\n\r\nimport ProgressPanel from \"../../components/progressPanel/progressPanel\";\r\nimport {\r\n  handleNotes,\r\n  handleBookmarks,\r\n  handleDigests,\r\n  handleFetchNotes,\r\n  handleFetchBookmarks,\r\n  handleFetchDigests,\r\n  handleFetchChapters,\r\n  handleFetchHighlighters\r\n\r\n  // handleLocations\r\n} from \"../../redux/reader.redux\";\r\nimport { handleFetchPercentage } from \"../../redux/progressPanel.redux\";\r\nimport { handleMessageBox } from \"../../redux/manager.redux\";\r\nimport \"./reader.css\";\r\nimport { connect } from \"react-redux\";\r\nclass Reader extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isOpenSettingPanel: false,\r\n      isOpenOperationPanel: false,\r\n      isOpenProgressPanel: false,\r\n      isOpenInfoPanel: false,\r\n      isMessage: false\r\n    };\r\n  }\r\n  componentWillMount() {\r\n    this.props.handleFetchBookmarks();\r\n    this.props.handleFetchPercentage(this.props.currentBook);\r\n\r\n    this.props.handleFetchNotes();\r\n    this.props.handleFetchDigests();\r\n    this.props.handleFetchHighlighters();\r\n    this.props.handleFetchChapters(this.props.currentEpub);\r\n  }\r\n  UNSAFE_componentWillReceiveProps(nextProps) {\r\n    // console.log(nextProps);\r\n    this.setState({\r\n      isMessage: nextProps.isMessage\r\n    });\r\n    if (nextProps.isMessage) {\r\n      setTimeout(() => {\r\n        this.props.handleMessageBox(false);\r\n        this.setState({ isMessage: false });\r\n      }, 2000);\r\n    }\r\n    console.log(this.state.isMessage, \"asdgsgjhf\");\r\n  }\r\n  componentDidMount() {\r\n    window.rangy.init(); // 初始化\r\n  }\r\n\r\n  // 为state的属性设置相应的值\r\n  setConfig(key, value) {\r\n    this.setState({ [key]: value });\r\n    // styleConfig.set(key, value);\r\n  }\r\n\r\n  handleEnter = position => {\r\n    console.log(\"enter\");\r\n\r\n    switch (position) {\r\n      case \"right\":\r\n        this.setState({\r\n          isOpenSettingPanel: this.state.isOpenSettingPanel ? false : true\r\n        });\r\n        break;\r\n      case \"left\":\r\n        this.setState({\r\n          isOpenInfoPanel: this.state.isOpenInfoPanel ? false : true\r\n        });\r\n        break;\r\n      case \"top\":\r\n        this.setState({\r\n          isOpenOperationPanel: this.state.isOpenOperationPanel ? false : true\r\n        });\r\n        break;\r\n      case \"bottom\":\r\n        this.setState({\r\n          isOpenProgressPanel: this.state.isOpenProgressPanel ? false : true\r\n        });\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    // this.setState({ isOpenSettingPanel: true });\r\n  };\r\n  handleLeave = position => {\r\n    console.log(\"leave\");\r\n    switch (position) {\r\n      case \"right\":\r\n        this.setState({ isOpenSettingPanel: false });\r\n        break;\r\n      case \"left\":\r\n        this.setState({ isOpenInfoPanel: false });\r\n        break;\r\n      case \"top\":\r\n        this.setState({ isOpenOperationPanel: false });\r\n        break;\r\n      case \"bottom\":\r\n        this.setState({ isOpenProgressPanel: false });\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n    // this.setState({ isOpenSettingPanel: false });\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"viewer\">\r\n        {this.state.isMessage ? <MessageBox /> : null}\r\n\r\n        <div\r\n          className=\"left-panel\"\r\n          onMouseEnter={() => {\r\n            this.handleEnter(\"left\");\r\n          }}\r\n        ></div>\r\n        <div\r\n          className=\"right-panel\"\r\n          onMouseEnter={() => {\r\n            this.handleEnter(\"right\");\r\n          }}\r\n        ></div>\r\n        <div\r\n          className=\"top-panel\"\r\n          onMouseEnter={() => {\r\n            this.handleEnter(\"top\");\r\n          }}\r\n        ></div>\r\n        <div\r\n          className=\"bottom-panel\"\r\n          onMouseEnter={() => {\r\n            this.handleEnter(\"bottom\");\r\n          }}\r\n        ></div>\r\n        <ViewArea className=\"view-area\" />\r\n        {this.state.isOpenSettingPanel ? (\r\n          <div\r\n            onMouseLeave={() => {\r\n              this.handleLeave(\"right\");\r\n            }}\r\n          >\r\n            <SettingPanel className=\"setting-panel\" />\r\n          </div>\r\n        ) : null}\r\n        {this.state.isOpenInfoPanel ? (\r\n          <div\r\n            onMouseLeave={() => {\r\n              this.handleLeave(\"left\");\r\n            }}\r\n          >\r\n            <NavigationPanel className=\"navigation-panel\" />\r\n          </div>\r\n        ) : null}\r\n        {this.state.isOpenProgressPanel ? (\r\n          <div\r\n            className=\"progress-panel-container\"\r\n            onMouseLeave={() => {\r\n              this.handleLeave(\"bottom\");\r\n            }}\r\n          >\r\n            <ProgressPanel className=\"progress-panel\" />\r\n          </div>\r\n        ) : null}\r\n        {this.state.isOpenOperationPanel ? (\r\n          <div\r\n            className=\"operation-panel-container\"\r\n            onMouseLeave={() => {\r\n              this.handleLeave(\"top\");\r\n            }}\r\n          >\r\n            <OperationPanel className=\"book-operation-panel\" />\r\n          </div>\r\n        ) : null}\r\n\r\n        <Background className=\"background\" />\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    isMessage: state.manager.isMessage\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleNotes,\r\n  handleBookmarks,\r\n  handleDigests,\r\n  handleFetchNotes,\r\n  handleFetchBookmarks,\r\n  handleFetchDigests,\r\n  handleFetchChapters,\r\n  handleFetchHighlighters,\r\n  handleMessageBox,\r\n  handleFetchPercentage\r\n};\r\nReader = connect(mapStateToProps, actionCreator)(Reader);\r\nexport default Reader;\r\n","const initState = {\r\n  mode: \"home\",\r\n  shelfIndex: null\r\n  // cover:''\r\n};\r\nexport function sidebar(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"HANDLE_MODE\":\r\n      return {\r\n        ...state,\r\n        mode: action.payload\r\n      };\r\n    case \"HANDLE_SHELF_INDEX\":\r\n      return {\r\n        ...state,\r\n        shelfIndex: action.payload\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport function handleShelfIndex(shelfIndex) {\r\n  console.log(shelfIndex);\r\n  return { type: \"HANDLE_SHELF_INDEX\", payload: shelfIndex };\r\n}\r\n\r\nexport function handleMode(mode) {\r\n  console.log(mode);\r\n  return { type: \"HANDLE_MODE\", payload: mode };\r\n}\r\n","// 记录书本打开记录\r\nconst defaultShelf = {\r\n  新建书架: null,\r\n  工作学习: [],\r\n  生活百科: [],\r\n  休闲娱乐: []\r\n};\r\nclass ShelfUtil {\r\n  static setShelf(shelfTitle, bookKey) {\r\n    let json = localStorage.getItem(\"shelfList\");\r\n    let obj = JSON.parse(json) || defaultShelf;\r\n    if (obj[shelfTitle] === undefined) {\r\n      obj[shelfTitle] = [];\r\n    }\r\n    if (obj[shelfTitle].indexOf(bookKey) === -1) {\r\n      obj[shelfTitle].unshift(bookKey);\r\n    }\r\n    // console.log(cfi, \"dfhdafhdfh\");\r\n    localStorage.setItem(\"shelfList\", JSON.stringify(obj));\r\n  }\r\n\r\n  static getShelf() {\r\n    let json = localStorage.getItem(\"shelfList\");\r\n    let obj = JSON.parse(json) || defaultShelf;\r\n\r\n    return obj || null;\r\n  }\r\n  static clearShelf(shelfTitle, bookKey) {\r\n    let json = localStorage.getItem(\"shelfList\");\r\n    let obj = JSON.parse(json) || defaultShelf;\r\n    let index = obj[shelfTitle].findIndex(bookKey);\r\n    obj[shelfTitle].splice(index, 1);\r\n\r\n    localStorage.setItem(\"shelfList\", JSON.stringify(obj));\r\n  }\r\n  static removeShelf(shelfTitle) {\r\n    let json = localStorage.getItem(\"shelfList\");\r\n    let obj = JSON.parse(json) || defaultShelf;\r\n    delete obj.shelfTitle;\r\n\r\n    localStorage.setItem(\"shelfList\", JSON.stringify(obj));\r\n  }\r\n}\r\n\r\nexport default ShelfUtil;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport \"./about.css\";\r\n\r\nclass About extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isNew: false,\r\n      isGithub: false,\r\n      isContact: false,\r\n      isDonate: false\r\n    };\r\n  }\r\n  handleGithub = mode => {\r\n    this.setState({ isGithub: mode });\r\n  };\r\n  handleContact = mode => {\r\n    this.setState({ isContact: mode });\r\n  };\r\n  handleDonate = mode => {\r\n    this.setState({ isDonate: mode });\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"about-container\">\r\n        {this.state.isGithub ? (\r\n          <div className=\"about-box\">\r\n            <div className=\"about-message\">\r\n              本项目所有代码均已在GitHub上开源，点击前往查看\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n        {this.state.isContact ? (\r\n          <div className=\"about-box\">\r\n            <div className=\"about-message\">\r\n              向开发者反馈您在使用过程中遇到的问题和改进建议\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n        {this.state.isDonate ? (\r\n          <div className=\"about-box\">\r\n            <div className=\"about-message\">\r\n              维护本项目需要占用大量时间，如果您觉得本项目对您有帮助，欢迎打赏开发者\r\n            </div>\r\n          </div>\r\n        ) : null}\r\n\r\n        <div className=\"about-icon-container\">\r\n          <a\r\n            href=\"http://www.baidu.com\"\r\n            target=\"_blank\"\r\n            rel=\"noopener noreferrer\"\r\n          >\r\n            <span\r\n              className=\"icon-github about-icon\"\r\n              onMouseEnter={() => {\r\n                this.handleGithub(true);\r\n              }}\r\n              onMouseLeave={() => {\r\n                this.handleGithub(false);\r\n              }}\r\n            ></span>\r\n          </a>\r\n\r\n          <span\r\n            className=\"icon-contact about-icon\"\r\n            onMouseEnter={() => {\r\n              this.handleContact(true);\r\n            }}\r\n            onMouseLeave={() => {\r\n              this.handleContact(false);\r\n            }}\r\n          ></span>\r\n          <span\r\n            className=\"icon-donate about-icon\"\r\n            onMouseEnter={() => {\r\n              this.handleDonate(true);\r\n            }}\r\n            onMouseLeave={() => {\r\n              this.handleDonate(false);\r\n            }}\r\n          ></span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {};\r\n};\r\nconst actionCreator = {};\r\nAbout = connect(mapStateToProps, actionCreator)(About);\r\nexport default About;\r\n","import React, { Component } from \"react\";\r\nimport \"./sidebar.css\";\r\nimport { handleMode, handleShelfIndex } from \"../../redux/sidebar.redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { sideMenu } from \"../../utils/readerConfig\";\r\nimport ShelfUtil from \"../../utils/shelfUtil\";\r\nimport About from \"../about/about\";\r\nclass Sidebar extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      index: [\"home\", \"recent\", \"bookmark\", \"note\", \"digest\"].indexOf(\r\n        this.props.mode\r\n      ),\r\n      isCollapse: true,\r\n      shelfIndex: null\r\n    };\r\n  }\r\n  handleSidebar = (mode, index) => {\r\n    console.log(index);\r\n    this.setState({ index: index });\r\n    this.setState({ shelfIndex: null });\r\n    this.setState({ isCollapse: true });\r\n    this.props.handleMode(mode);\r\n    this.props.handleShelfIndex(null);\r\n  };\r\n  handleShelf = () => {\r\n    this.setState({ isCollapse: !this.state.isCollapse });\r\n  };\r\n  handleShelfItem = index => {\r\n    console.log(index);\r\n    this.setState({ shelfIndex: index });\r\n    this.props.handleShelfIndex(index);\r\n    this.props.handleMode(\"shelf\");\r\n  };\r\n  render() {\r\n    const renderSideMenu = () => {\r\n      return sideMenu.map((item, index) => {\r\n        return (\r\n          <li\r\n            key={item.name}\r\n            className={\r\n              this.state.index === index && this.state.shelfIndex === null\r\n                ? \"active side-menu-item\"\r\n                : \"side-menu-item\"\r\n            }\r\n            id={`sidebar-${item.icon}`}\r\n            onClick={() => {\r\n              this.handleSidebar(item.mode, index);\r\n            }}\r\n          >\r\n            {this.state.index === index && this.state.shelfIndex === null ? (\r\n              <div className=\"side-menu-selector-container\"></div>\r\n            ) : null}\r\n            <div\r\n              className={\r\n                this.state.index === index && this.state.shelfIndex === null\r\n                  ? \"side-menu-selector active-selector\"\r\n                  : \"side-menu-selector \"\r\n              }\r\n            >\r\n              <span\r\n                className={\r\n                  this.state.index === index && this.state.shelfIndex === null\r\n                    ? `icon-${item.icon} side-menu-icon  active-icon`\r\n                    : `icon-${item.icon} side-menu-icon`\r\n                }\r\n              ></span>\r\n\r\n              {item.name}\r\n            </div>\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n    const renderShelfList = () => {\r\n      const shelfList = Object.keys(ShelfUtil.getShelf());\r\n      // console.log(shelfList, \"shelfList\");\r\n      //去除开头的新建书架\r\n      shelfList.splice(0, 1);\r\n      return shelfList.map((item, index) => {\r\n        return (\r\n          <li\r\n            key={index}\r\n            className={\r\n              this.state.shelfIndex === index\r\n                ? \"shelf-list-item active-shelf \"\r\n                : \"shelf-list-item\"\r\n            }\r\n            onClick={() => {\r\n              this.handleShelfItem(index);\r\n            }}\r\n          >\r\n            {item}\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n    return (\r\n      <div className=\"sidebar\">\r\n        <img src=\"../../assets/logo.jpg\" alt=\"\" className=\"logo\" />\r\n\r\n        <ul className=\"side-menu-container\">\r\n          {renderSideMenu()}\r\n          <li className=\"side-menu-shelf\">\r\n            <div\r\n              onClick={() => {\r\n                this.handleShelf();\r\n              }}\r\n            >\r\n              <span className=\"icon-shelf\"></span>\r\n              {\"我的书架\"}\r\n              <span\r\n                className={\r\n                  this.state.isCollapse ? \"icon-dropdown\" : \"icon-shangla\"\r\n                }\r\n              ></span>\r\n            </div>\r\n\r\n            <ul\r\n              className=\"shelf-list-container\"\r\n              style={this.state.isCollapse ? { display: \"none\" } : {}}\r\n            >\r\n              {renderShelfList()}\r\n            </ul>\r\n          </li>\r\n        </ul>\r\n        <About />\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { mode: state.sidebar.mode };\r\n};\r\nconst actionCreator = { handleMode, handleShelfIndex };\r\nSidebar = connect(mapStateToProps, actionCreator)(Sidebar);\r\nexport default Sidebar;\r\n","import React, { Component } from \"react\";\r\nimport \"./searchBox.css\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  handleFetchBooks,\r\n  handleSearchBooks,\r\n  handleSearch\r\n} from \"../../redux/manager.redux\";\r\nimport OtherUtil from \"../../utils/otherUtil\";\r\n// @connect(state => state.manager)\r\nclass Header extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isSearch: this.props.isSearch\r\n      // md5: null\r\n    };\r\n  }\r\n  UNSAFE_componentWillReceiveProps = nextProps => {\r\n    // console.log(nextProps);\r\n    this.setState({\r\n      isSearch: nextProps.isSearch\r\n    });\r\n  };\r\n\r\n  handleMouse = () => {\r\n    let results = OtherUtil.MouseSearch(this.props.books);\r\n    this.props.handleSearchBooks(results);\r\n    this.props.handleSearch(true);\r\n  };\r\n  handleKey = event => {\r\n    let results = OtherUtil.KeySearch(event, this.props.books);\r\n    // console.log(results, \"resultes\");\r\n    if (results !== undefined) {\r\n      this.props.handleSearchBooks(results);\r\n      this.props.handleSearch(true);\r\n    }\r\n  };\r\n\r\n  handleCancel = () => {\r\n    this.props.handleSearch(false);\r\n    document.querySelector(\".header-search-box\").value = \"\";\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"header-search-container\">\r\n        <input\r\n          type=\"text\"\r\n          placeholder=\"搜索我的书库\"\r\n          className=\"header-search-box\"\r\n          onKeyDown={event => {\r\n            this.handleKey(event);\r\n          }}\r\n        />\r\n        {this.props.isSearch ? (\r\n          <span\r\n            className=\"header-search-text\"\r\n            onClick={() => {\r\n              this.handleCancel();\r\n            }}\r\n          >\r\n            取消\r\n          </span>\r\n        ) : (\r\n          <span\r\n            className=\"icon-search header-search-icon\"\r\n            onClick={() => {\r\n              this.handleMouse();\r\n            }}\r\n          ></span>\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books,\r\n    isSearch: state.manager.isSearch\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleFetchBooks,\r\n  handleSearchBooks,\r\n  handleSearch\r\n};\r\nHeader = connect(mapStateToProps, actionCreator)(Header);\r\nexport default Header;\r\n","class Book {\r\n  constructor(name, author, description, content, md5) {\r\n    this.key = new Date().getTime() + \"\"; // 数据库的键\r\n    this.name = name; // 书籍名\r\n    this.author = author; // 作者\r\n    this.description = description; // 书籍的描述\r\n    this.content = content; // 代表内容的二进制数据\r\n    this.md5 = md5;\r\n  }\r\n}\r\n\r\nexport default Book;\r\n","import React, { Component } from \"react\";\r\nimport \"./importLocal.css\";\r\nimport BookModel from \"../../model/Book\";\r\nimport { connect } from \"react-redux\";\r\nimport localforage from \"localforage\";\r\nimport {\r\n  handleMessageBox,\r\n  handleMessage,\r\n  handleFetchBooks\r\n} from \"../../redux/manager.redux\";\r\nimport SparkMD5 from \"spark-md5\";\r\n// @connect(state => state.manager)\r\nclass ImportLocal extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isRepeat: false\r\n      // md5: null\r\n    };\r\n  }\r\n  handleAddBook = book => {\r\n    let bookArr = this.props.books;\r\n    console.log(bookArr, \"bookArr\");\r\n    if (bookArr == null) {\r\n      bookArr = [];\r\n    }\r\n    bookArr.push(book);\r\n    console.log(bookArr, \"sghasfkh\");\r\n    localforage.setItem(\"books\", bookArr).then(() => {\r\n      console.log(\"hadfhafh\");\r\n      this.props.handleFetchBooks();\r\n    });\r\n    this.props.handleMessage(\"添加成功\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n\r\n  doIncrementalTest = file => {\r\n    //这里假设直接将文件选择框的dom引用传入\r\n\r\n    //这里需要用到File的slice( )方法，以下是兼容写法\r\n    var blobSlice =\r\n        File.prototype.slice ||\r\n        File.prototype.mozSlice ||\r\n        File.prototype.webkitSlice,\r\n      chunkSize = 2097152, // 以每片2MB大小来逐次读取\r\n      chunks = Math.ceil(file.size / chunkSize),\r\n      currentChunk = 0,\r\n      spark = new SparkMD5(), //创建SparkMD5的实例\r\n      fileReader = new FileReader();\r\n\r\n    fileReader.onload = e => {\r\n      // console(\"Read chunk number (currentChunk + 1) of  chunks \");\r\n\r\n      spark.appendBinary(e.target.result); // append array buffer\r\n      currentChunk += 1;\r\n\r\n      if (currentChunk < chunks) {\r\n        loadNext();\r\n      } else {\r\n        console.log(\"Finished loading!\");\r\n        let md5 = spark.end(); // 完成计算，返回结果\r\n        // this.setState({ md5: md5 });\r\n        // console.log(md5, \"sgsgh\");\r\n        this.handleBook(file, md5);\r\n      }\r\n    };\r\n\r\n    function loadNext() {\r\n      var start = currentChunk * chunkSize,\r\n        end = start + chunkSize >= file.size ? file.size : start + chunkSize;\r\n\r\n      fileReader.readAsBinaryString(blobSlice.call(file, start, end));\r\n    }\r\n\r\n    loadNext();\r\n  };\r\n  handleBook = (file, md5) => {\r\n    if (this.props.books !== null) {\r\n      this.props.books.forEach(item => {\r\n        if (item.md5 === md5) {\r\n          this.setState({ isRepeat: true });\r\n          this.props.handleMessage(\"文件重复\");\r\n          this.props.handleMessageBox(true);\r\n        }\r\n      });\r\n    }\r\n\r\n    if (!this.state.isRepeat) {\r\n      let reader = new FileReader();\r\n      reader.readAsArrayBuffer(file);\r\n\r\n      reader.onload = e => {\r\n        // console.log(window.ePub);\r\n        const epub = window.ePub({ bookPath: e.target.result });\r\n        epub.getMetadata().then(metadata => {\r\n          let name, author, content, description, book;\r\n          [name, author, content, description] = [\r\n            metadata.bookTitle,\r\n            metadata.creator,\r\n            metadata.description,\r\n            e.target.result\r\n          ];\r\n          book = new BookModel(name, author, content, description, md5);\r\n          this.handleAddBook(book);\r\n        });\r\n      };\r\n    }\r\n  };\r\n  handleChange = event => {\r\n    event.preventDefault();\r\n    this.setState({ isRepeat: false });\r\n    let file = event.target.files[0];\r\n    console.log(file);\r\n    this.doIncrementalTest(file);\r\n  };\r\n\r\n  render() {\r\n    // const classes = this.props.classes;\r\n\r\n    return (\r\n      <div className=\"import-from-local\">\r\n        从本地导入\r\n        <input\r\n          type=\"file\"\r\n          id=\"import-book-box\"\r\n          accept=\"application/epub+zip\"\r\n          className=\"import-book-box\"\r\n          name=\"file\"\r\n          multiple=\"multiple\"\r\n          onChange={event => {\r\n            this.handleChange(event);\r\n          }}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleMessageBox,\r\n  handleMessage,\r\n  handleFetchBooks\r\n};\r\nImportLocal = connect(mapStateToProps, actionCreator)(ImportLocal);\r\nexport default ImportLocal;\r\n","// import localforage from \"localforage\";\r\nconst initState = {\r\n  isChoose:false\r\n};\r\nexport function chooseDrive(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"HANDLE_CHOOSE\":\r\n      return {\r\n        ...state,\r\n        isChoose: action.payload\r\n      };\r\n\r\n    \r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport function handleChoose(mode) {\r\n  return { type: \"HANDLE_CHOOSE\", payload: mode };\r\n}\r\n\r\n\r\n// export function handleFetchLocations(epub) {\r\n//   return dispatch => {\r\n//     console.log(epub);\r\n//     if (epub.locations !== undefined) {\r\n//       epub.locations.generate().then(result => {\r\n//         let locations = epub.locations;\r\n//         console.log(\"sfhafshfhafh\");\r\n//         dispatch(handleLocations(locations));\r\n//       });\r\n//     }\r\n//   };\r\n// }\r\n","import React, { Component } from \"react\";\r\nimport \"./header.css\";\r\nimport { connect } from \"react-redux\";\r\nimport SearchBox from \"../searchBox/searchBox\";\r\nimport ImportLocal from \"../importLocal/importLocal\";\r\nimport {\r\n  handleFetchBooks,\r\n  handleSort,\r\n  handleSortCode,\r\n  handleSortDisplay,\r\n  handleMessageBox,\r\n  handleMessage\r\n} from \"../../redux/manager.redux\";\r\nimport { handleChoose } from \"../../redux/chooseDrive.redux\";\r\n// @connect(state => state.manager)\r\nclass Header extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isSort: this.props.isSort,\r\n      sortCode: this.props.sortCode,\r\n      isSortDisplay: this.props.isSortDisplay,\r\n      isOnlyLocal: false\r\n      // md5: null\r\n    };\r\n  }\r\n  UNSAFE_componentWillReceiveProps = nextProps => {\r\n    // console.log(nextProps);\r\n    this.setState({\r\n      isSort: nextProps.isSort,\r\n      isSortDisplay: nextProps.isSortDisplay,\r\n      sortCode: nextProps.sortCode\r\n    });\r\n  };\r\n\r\n  handleSortBooks = () => {\r\n    console.log(this.state.isSortDisplay, \"ahdgslahg\");\r\n    if (this.state.isSortDisplay) {\r\n      this.props.handleSortDisplay(false);\r\n    } else {\r\n      this.props.handleSortDisplay(true);\r\n    }\r\n\r\n    // this.props.handleSortDisplay(!this.state.isSortDisplay);\r\n    // console.log(this.state.isSortDisplay);\r\n  };\r\n  handleChoose = () => {\r\n    this.props.handleChoose(true);\r\n  };\r\n  handleOnlyLocal = () => {\r\n    this.setState({ isOnlyLocal: !this.state.isOnlyLocal });\r\n    this.props.handleMessage(\"下载客户端体验完整功能\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  render() {\r\n    // const classes = this.props.classes;\r\n\r\n    return (\r\n      <div className=\"header\">\r\n        <SearchBox />\r\n        <div\r\n          className=\"header-sort-container\"\r\n          onClick={() => {\r\n            this.handleSortBooks();\r\n          }}\r\n        >\r\n          <span className=\"header-sort-text\">排序</span>\r\n          <span className=\"icon-sort header-sort-icon\"></span>\r\n        </div>\r\n        {this.state.isSort}\r\n        <div className=\"only-local-container\">\r\n          <span className=\"only-local-text\">只显示本地图书</span>\r\n          <div\r\n            className=\"only-local-icon\"\r\n            onClick={() => {\r\n              this.handleOnlyLocal();\r\n            }}\r\n          >\r\n            <div\r\n              className=\"only-local-slider\"\r\n              style={this.state.isOnlyLocal ? { marginLeft: \"16px\" } : {}}\r\n            ></div>\r\n          </div>\r\n        </div>\r\n        <ImportLocal />\r\n\r\n        <div\r\n          className=\"import-from-cloud\"\r\n          onClick={() => {\r\n            this.handleChoose();\r\n          }}\r\n        >\r\n          从云端同步\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books,\r\n    isSearch: state.manager.isSearch,\r\n    isSortDisplay: state.manager.isSortDisplay\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleFetchBooks,\r\n  handleSort,\r\n  handleSortCode,\r\n  handleSortDisplay,\r\n  handleMessageBox,\r\n  handleMessage,\r\n  handleChoose\r\n};\r\nHeader = connect(mapStateToProps, actionCreator)(Header);\r\nexport default Header;\r\n","// 记录书本打开记录\r\nclass RecordRecent {\r\n  static setRecent(bookKey) {\r\n    let json = localStorage.getItem(\"recentBooks\");\r\n    let obj = JSON.parse(json) || {};\r\n    let date = {\r\n      year: new Date().getFullYear(),\r\n      month: new Date().getMonth() + 1,\r\n      day: new Date().getDate()\r\n    };\r\n    // let openTime = new Date().getTime();\r\n    obj[bookKey] = { bookKey: bookKey, date: date };\r\n    // console.log(cfi, \"dfhdafhdfh\");\r\n    localStorage.setItem(\"recentBooks\", JSON.stringify(obj));\r\n  }\r\n\r\n  static getRecent() {\r\n    let json = localStorage.getItem(\"recentBooks\");\r\n    let obj = JSON.parse(json) || {};\r\n\r\n    return obj || null;\r\n  }\r\n  static clear(bookKey) {\r\n    let json = localStorage.getItem(\"recentBooks\");\r\n    let obj = JSON.parse(json) || {};\r\n    delete obj[bookKey];\r\n\r\n    localStorage.setItem(\"recentBooks\", JSON.stringify(obj));\r\n  }\r\n}\r\n\r\nexport default RecordRecent;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  handleEditDialog,\r\n  handleDeleteDialog,\r\n  handleAddDialog,\r\n  handleReadingState,\r\n  handleReadingBook,\r\n  handleReadingEpub\r\n} from \"../../redux/book.redux\";\r\nimport RecentBooks from \"../../utils/recordRecent\";\r\nimport \"./book.css\";\r\n\r\nclass Book extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isDeleteDialog: false, isOpenConfig: false };\r\n    this.handleOpenBook = this.handleOpenBook.bind(this);\r\n    this.epub = null;\r\n  }\r\n  UNSAFE_componentWillMount() {\r\n    this.epub = window.ePub({\r\n      bookPath: this.props.book.content,\r\n      restore: false\r\n    });\r\n  }\r\n  handleOpenBook() {\r\n    this.props.handleReadingBook(this.props.book);\r\n    this.props.handleReadingEpub(this.epub);\r\n    this.props.handleReadingState(true);\r\n    RecentBooks.setRecent(this.props.book.key);\r\n  }\r\n  handleDeleteBook = () => {\r\n    this.props.handleDeleteDialog(true);\r\n    this.props.handleReadingBook(this.props.book);\r\n  };\r\n  handleEditBook = () => {\r\n    this.props.handleEditDialog(true);\r\n    this.props.handleReadingBook(this.props.book);\r\n  };\r\n  handleAddShelf = () => {\r\n    this.props.handleAddDialog(true);\r\n    this.props.handleReadingBook(this.props.book);\r\n  };\r\n  handleConfig = mode => {\r\n    // console.log(mode, \"mode\");\r\n    this.setState({ isOpenConfig: mode });\r\n  };\r\n  render() {\r\n    // console.log(this.props.isReading, \"agsffh\");\r\n    return (\r\n      <div\r\n        className=\"book-list-item\"\r\n        onMouseEnter={() => {\r\n          this.handleConfig(true);\r\n        }}\r\n        onMouseLeave={() => {\r\n          this.handleConfig(false);\r\n        }}\r\n      >\r\n        <img\r\n          className=\"book-item-cover\"\r\n          src={\r\n            this.props.bookCover !== null\r\n              ? this.props.bookCover\r\n              : \"../../assets/cover.jpg\"\r\n          }\r\n          alt=\"\"\r\n          onClick={() => {\r\n            this.handleOpenBook();\r\n          }}\r\n        />\r\n        <p className=\"book-item-title\">{this.props.book.name}</p>\r\n        {this.state.isOpenConfig ? (\r\n          <div className=\"book-item-config\">\r\n            <span\r\n              className=\"icon-add view-icon\"\r\n              onClick={() => {\r\n                this.handleAddShelf();\r\n              }}\r\n            ></span>\r\n            <span\r\n              className=\"icon-delete view-icon\"\r\n              onClick={() => {\r\n                this.handleDeleteBook();\r\n              }}\r\n            ></span>\r\n            <span\r\n              className=\"icon-edit view-icon\"\r\n              onClick={() => {\r\n                this.handleEditBook();\r\n              }}\r\n            ></span>\r\n          </div>\r\n        ) : null}\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { isReading: state.book.isReading };\r\n};\r\nconst actionCreator = {\r\n  handleReadingState,\r\n  handleReadingBook,\r\n  handleReadingEpub,\r\n  handleEditDialog,\r\n  handleDeleteDialog,\r\n  handleAddDialog\r\n};\r\nBook = connect(mapStateToProps, actionCreator)(Book);\r\nexport default Book;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  handleEditDialog,\r\n  handleDeleteDialog,\r\n  handleAddDialog,\r\n  handleReadingState,\r\n  handleReadingBook,\r\n  handleReadingEpub\r\n} from \"../../redux/book.redux\";\r\nimport RecentBooks from \"../../utils/recordRecent\";\r\nimport \"./bookItem.css\";\r\nimport RecordRecent from \"../../utils/recordRecent\";\r\nimport RecordLocation from \"../../utils/recordLocation\";\r\nclass Book extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isDeleteDialog: false };\r\n    this.handleOpenBook = this.handleOpenBook.bind(this);\r\n    this.epub = null;\r\n  }\r\n  UNSAFE_componentWillMount() {\r\n    this.epub = window.ePub({\r\n      bookPath: this.props.book.content,\r\n      restore: false\r\n    });\r\n  }\r\n  handleOpenBook() {\r\n    this.props.handleReadingBook(this.props.book);\r\n    this.props.handleReadingEpub(this.epub);\r\n    this.props.handleReadingState(true);\r\n    RecentBooks.setRecent(this.props.book.key);\r\n  }\r\n  handleDeleteBook = () => {\r\n    this.props.handleDeleteDialog(true);\r\n    this.props.handleReadingBook(this.props.book);\r\n  };\r\n  handleEditBook = () => {\r\n    this.props.handleEditDialog(true);\r\n    this.props.handleReadingBook(this.props.book);\r\n  };\r\n  handleAddShelf = () => {\r\n    this.props.handleAddDialog(true);\r\n    this.props.handleReadingBook(this.props.book);\r\n  };\r\n  render() {\r\n    // console.log(this.props.isReading, \"agsffh\");\r\n    let date =\r\n      RecordRecent.getRecent()[this.props.book.key] !== null &&\r\n      RecordRecent.getRecent()[this.props.book.key] !== undefined\r\n        ? RecordRecent.getRecent()[this.props.book.key].date\r\n        : { year: \"0000\", month: \"00\", day: \"00\" };\r\n    let percentage =\r\n      RecordLocation.getCfi(this.props.book.key) !== null &&\r\n      RecordLocation.getCfi(this.props.book.key) !== undefined\r\n        ? RecordLocation.getCfi(this.props.book.key).percentage\r\n        : 0;\r\n    return (\r\n      <div className=\"book-list-item-container\">\r\n        <img\r\n          className=\"book-item-list-cover\"\r\n          src={\r\n            this.props.bookCover !== null\r\n              ? this.props.bookCover\r\n              : \"../../assets/cover.jpg\"\r\n          }\r\n          alt=\"\"\r\n          onClick={() => {\r\n            this.handleOpenBook();\r\n          }}\r\n        />\r\n        <p className=\"book-item-list-title\">{this.props.book.name}</p>\r\n        <p className=\"book-item-list-author\">{this.props.book.author}</p>\r\n        <p className=\"book-item-list-date\">\r\n          {\"\" + date.year + \"-\" + date.month + \"-\" + date.day}\r\n        </p>\r\n        <p className=\"book-item-list-percentage\">\r\n          {Math.round(percentage * 100)}%\r\n        </p>\r\n        <div className=\"book-item-list-config\">\r\n          <span\r\n            className=\"icon-add list-icon\"\r\n            onClick={() => {\r\n              this.handleAddShelf();\r\n            }}\r\n            color=\"rgba(75,75,75,1)\"\r\n          ></span>\r\n          <span\r\n            className=\"icon-delete list-icon\"\r\n            onClick={() => {\r\n              this.handleDeleteBook();\r\n            }}\r\n          ></span>\r\n          <span\r\n            className=\"icon-edit list-icon\"\r\n            onClick={() => {\r\n              this.handleEditBook();\r\n            }}\r\n          ></span>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { isReading: state.book.isReading };\r\n};\r\nconst actionCreator = {\r\n  handleReadingState,\r\n  handleReadingBook,\r\n  handleReadingEpub,\r\n  handleEditDialog,\r\n  handleDeleteDialog,\r\n  handleAddDialog\r\n};\r\nBook = connect(mapStateToProps, actionCreator)(Book);\r\nexport default Book;\r\n","// import localforage from \"localforage\";\r\nconst getBookName = books => {\r\n  let nameArr = [];\r\n  books.forEach(item => {\r\n    // console.log(item.name);\r\n    nameArr.push(item.name);\r\n  });\r\n  // console.log(nameArr[0]);\r\n  return nameArr;\r\n};\r\nconst getBookIndex = (nameArr, oldNameArr) => {\r\n  let indexArr = [];\r\n  nameArr.forEach(item => {\r\n    // console.log(item, nameArr, oldNameArr, oldNameArr.indexOf(item));\r\n    indexArr.push(oldNameArr.indexOf(item));\r\n  });\r\n  // console.log(indexArr);\r\n  return indexArr;\r\n};\r\nclass SortUtil {\r\n  static sortBooks(books, sortCode) {\r\n    if (sortCode.sort === 1 && sortCode.order === 1) {\r\n      // console.log(books);\r\n      let oldNameArr = getBookName(books);\r\n      let nameArr = getBookName(books).sort();\r\n\r\n      // console.log(nameArr[0], oldNameArr[0]);\r\n      // console.log(getBookIndex(nameArr, oldNameArr));\r\n      return getBookIndex(nameArr, oldNameArr);\r\n    }\r\n    if (sortCode.sort === 1 && sortCode.order === 2) {\r\n      let oldNameArr = getBookName(books);\r\n      let nameArr = getBookName(books)\r\n        .sort()\r\n        .reverse();\r\n      // console.log(nameArr);\r\n      // console.log(getBookIndex(nameArr, oldNameArr));\r\n      return getBookIndex(nameArr, oldNameArr);\r\n    }\r\n    if (sortCode.sort === 2 && sortCode.order === 1) {\r\n      let nameArr = [];\r\n      for (let i = 0; i < books.length; i++) {\r\n        nameArr.push(i);\r\n      }\r\n      return nameArr;\r\n    }\r\n    if (sortCode.sort === 2 && sortCode.order === 2) {\r\n      let nameArr = [];\r\n      // console.log(books, \"books\");\r\n      for (let i = 0; i < books.length; i++) {\r\n        nameArr.push(i);\r\n      }\r\n      return nameArr.reverse();\r\n    }\r\n  }\r\n}\r\n\r\nexport default SortUtil;\r\n","import React, { Component } from \"react\";\r\nimport \"./booklist.css\";\r\nimport Book from \"../book/book\";\r\nimport BookItem from \"../bookItem/bookItem\";\r\nimport { connect } from \"react-redux\";\r\nimport RecordRecent from \"../../utils/recordRecent\";\r\nimport ShelfUtil from \"../../utils/shelfUtil\";\r\nimport SortUtil from \"../../utils/sortUtil\";\r\nclass BookList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      books: this.props.books,\r\n      covers: this.props.covers,\r\n      shelfIndex: this.props.shelfIndex,\r\n      isList: this.props.isList,\r\n      isSearch: this.props.isSearch,\r\n      isSort: this.props.isSort,\r\n      sortCode: this.props.sortCode,\r\n      searchBooks: this.props.searchBooks\r\n    };\r\n  }\r\n  UNSAFE_componentWillReceiveProps = nextProps => {\r\n    // console.log(nextProps);\r\n    this.setState({\r\n      books: nextProps.books,\r\n      covers: nextProps.covers,\r\n      shelfIndex: nextProps.shelfIndex,\r\n      isSearch: nextProps.isSearch,\r\n      isSort: nextProps.isSort,\r\n      sortCode: nextProps.sortCode,\r\n      searchBooks: nextProps.searchBooks\r\n    });\r\n    // console.log(this.state.sortCode);\r\n  };\r\n  handleRecent = items => {\r\n    let recentArr = [];\r\n    for (let i in RecordRecent.getRecent()) {\r\n      recentArr.push(RecordRecent.getRecent()[i].bookKey);\r\n    }\r\n    // console.log(items);\r\n    // RecordRecent.getRecent();\r\n    let recentItems = items.filter(item => {\r\n      // console.log(item.key, recentArr.indexOf(item.key));\r\n\r\n      return recentArr.indexOf(item.key) > -1;\r\n    });\r\n    // console.log(recentBooks);\r\n    return recentItems;\r\n  };\r\n  handleShelf(items, index) {\r\n    let shelfTitle = Object.keys(ShelfUtil.getShelf());\r\n    // console.log(shelfTitle, index, \"shelfTitle\");\r\n    let currentShelfTitle = shelfTitle[index + 1];\r\n    let currentShelfList = ShelfUtil.getShelf()[currentShelfTitle];\r\n    // console.log(currentShelfList);\r\n    let shelfItems = items.filter(item => {\r\n      // console.log(item.key, currentShelfList.indexOf(item.key));\r\n\r\n      return currentShelfList.indexOf(item.key) > -1;\r\n    });\r\n    // console.log(recentBooks);\r\n    return shelfItems;\r\n  }\r\n  handleChange = mode => {\r\n    this.setState({ isList: mode });\r\n    localStorage.setItem(\"isList\", mode);\r\n  };\r\n  handleSearch = (items, arr) => {\r\n    // console.log(arr, \"arr\");\r\n    let itemArr = [];\r\n\r\n    arr.forEach(item => {\r\n      itemArr.push(items[item]);\r\n    });\r\n    return itemArr;\r\n  };\r\n  render() {\r\n    localStorage.setItem(\"totalBooks\", this.props.books.length);\r\n\r\n    // console.log(this.state.isList);\r\n    const renderBookList = () => {\r\n      // console.log(this.state.books, \"sdgasf\");\r\n      let books =\r\n        this.props.mode === \"recent\"\r\n          ? this.handleRecent(this.state.books)\r\n          : this.state.shelfIndex !== null\r\n          ? this.handleShelf(this.state.books, this.state.shelfIndex)\r\n          : this.state.isSearch\r\n          ? this.handleSearch(this.state.books, this.props.searchBooks)\r\n          : this.state.isSort\r\n          ? this.handleSearch(\r\n              this.state.books,\r\n              SortUtil.sortBooks(this.state.books, this.state.sortCode)\r\n            )\r\n          : this.state.books;\r\n      // console.log(this.props.covers);\r\n      let covers =\r\n        this.props.mode === \"recent\"\r\n          ? this.handleRecent(this.state.covers)\r\n          : this.state.shelfIndex !== null\r\n          ? this.handleShelf(this.state.covers, this.state.shelfIndex)\r\n          : this.state.isSearch\r\n          ? this.handleSearch(this.state.covers, this.props.searchBooks)\r\n          : this.state.isSort\r\n          ? this.handleSearch(\r\n              this.state.covers,\r\n              SortUtil.sortBooks(this.state.books, this.state.sortCode)\r\n            )\r\n          : this.state.covers;\r\n      return books.map((item, index) => {\r\n        // console.log(covers, \"djhdhdfh\");\r\n        // console.log(this.state.isList, \"sdgasf\");\r\n        // let mode = this.state.isList;\r\n        // console.log(mode);\r\n        return this.state.isList === \"list\" ? (\r\n          <BookItem\r\n            key={item.key}\r\n            book={item}\r\n            bookCover={covers[index] ? covers[index].url : null}\r\n          />\r\n        ) : (\r\n          <Book\r\n            key={item.key}\r\n            book={item}\r\n            bookCover={covers[index] ? covers[index].url : null}\r\n          />\r\n        );\r\n      });\r\n    };\r\n    return (\r\n      <div className=\"book-list-container\">\r\n        <div className=\"book-list-view\">\r\n          <div\r\n            className=\"card-list-mode\"\r\n            onClick={() => {\r\n              this.handleChange(\"card\");\r\n            }}\r\n            style={\r\n              this.state.isList === \"card\"\r\n                ? {}\r\n                : { color: \"rgba(75,75,75,0.5)\" }\r\n            }\r\n          >\r\n            <span className=\"icon-grid\"></span> 卡片模式\r\n          </div>\r\n          <div\r\n            className=\"list-view-mode\"\r\n            onClick={() => {\r\n              this.handleChange(\"list\");\r\n            }}\r\n            style={\r\n              this.state.isList === \"list\"\r\n                ? {}\r\n                : { color: \"rgba(75,75,75,0.5)\" }\r\n            }\r\n          >\r\n            <span className=\"icon-list\"></span> 列表模式\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"book-list-item-box\">{renderBookList()}</div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books,\r\n    covers: state.manager.covers,\r\n    epubs: state.manager.epubs,\r\n    mode: state.sidebar.mode,\r\n    shelfIndex: state.sidebar.shelfIndex,\r\n    searchBooks: state.manager.searchBooks,\r\n    isSearch: state.manager.isSearch,\r\n    isSort: state.manager.isSort,\r\n    isList: state.manager.isList,\r\n    sortCode: state.manager.sortCode\r\n  };\r\n};\r\nBookList = connect(mapStateToProps)(BookList);\r\nexport default BookList;\r\n","import React, { Component } from \"react\";\r\nimport \"./bookmarkPage.css\";\r\nimport { connect } from \"react-redux\";\r\nimport { handleFetchBookmarks } from \"../../redux/reader.redux\";\r\nimport {\r\n  handleReadingState,\r\n  handleReadingBook,\r\n  handleReadingEpub\r\n} from \"../../redux/book.redux\";\r\nimport RecentBooks from \"../../utils/recordRecent\";\r\nimport RecordLocation from \"../../utils/recordLocation\";\r\nclass BookmarkPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { renderIndex: null };\r\n  }\r\n  UNSAFE_componentWillMount() {\r\n    this.props.handleFetchBookmarks();\r\n  }\r\n\r\n  handleRedirect = (key, cfi, percentage) => {\r\n    let { books, epubs } = this.props;\r\n    let book = {};\r\n    let epub = {};\r\n    for (let i = 0; i < books.length; i++) {\r\n      console.log(books[i].key, key, \"key\");\r\n      if (books[i].key === key) {\r\n        console.log(\"sdghasghgh\");\r\n        book = books[i];\r\n        epub = epubs[i];\r\n        break;\r\n      }\r\n    }\r\n    // let epub = {};\r\n    console.log(this.props.books, book);\r\n\r\n    this.props.handleReadingBook(book);\r\n    this.props.handleReadingEpub(epub);\r\n    this.props.handleReadingState(true);\r\n    RecentBooks.setRecent(key);\r\n    RecordLocation.recordCfi(key, cfi, percentage);\r\n  };\r\n  handlePopup = index => {\r\n    this.setState({ renderIndex: index });\r\n  };\r\n  handleClose = () => {\r\n    // console.log(\"hello\");\r\n    this.setState({ renderIndex: null });\r\n  };\r\n  render() {\r\n    let { bookmarks, books, covers } = this.props;\r\n    // console.log(this.props.state, \"bookmarks\");\r\n    let bookKeyArr = [];\r\n    bookmarks.forEach(item => {\r\n      if (bookKeyArr.indexOf(item.bookKey) === -1) {\r\n        bookKeyArr.push(item.bookKey);\r\n        return false;\r\n      }\r\n    });\r\n    // console.log(bookKeyArr, \"bookArr\");\r\n\r\n    let bookArr = books.filter(item => {\r\n      // console.log(item.key, bookKeyArr, \"haslghakfg\");\r\n      return bookKeyArr.indexOf(item.key) > -1;\r\n    });\r\n    // console.log(bookArr);\r\n    let coverArr = covers.filter(item => {\r\n      // console.log(item.key, bookKeyArr, \"asgalsgh\");\r\n      return bookKeyArr.indexOf(item.key) > -1;\r\n    });\r\n    let coverObj = {};\r\n    coverArr.forEach(item => {\r\n      coverObj[item.key] = item.url;\r\n    });\r\n    // console.log(coverObj, \"arr\");\r\n    let bookmarkObj = {};\r\n    bookmarks.forEach(item => {\r\n      if (!bookmarkObj[item.bookKey] && bookKeyArr.indexOf(item.bookKey) > -1) {\r\n        bookmarkObj[item.bookKey] = [];\r\n      }\r\n      if (bookKeyArr.indexOf(item.bookKey) > -1) {\r\n        bookmarkObj[item.bookKey].push(item);\r\n      }\r\n      return false;\r\n    });\r\n    console.log(bookmarkObj, \"bookmarkObj\");\r\n    // bookKeyArr.map(item => {});\r\n    const renderBookmarklistItem = item => {\r\n      return bookmarkObj[item.key].map(item => (\r\n        <li className=\"bookmark-page-list-item\" key={item.key}>\r\n          <div className=\"bookmark-page-list-item-title\">{item.chapter}</div>\r\n          <div className=\"bookmark-page-progress\">\r\n            {parseInt(item.percentage * 100)}%\r\n          </div>\r\n          <div\r\n            className=\"bookmark-page-list-item-link\"\r\n            onClick={() => {\r\n              this.handleRedirect(item.bookKey, item.cfi, item.percentage);\r\n            }}\r\n          >\r\n            <div className=\"bookmark-page-list-item-link-text\">点击跳转</div>\r\n          </div>\r\n        </li>\r\n      ));\r\n    };\r\n    const renderBookmarkPageItem = (item, index, isShowMore) => {\r\n      console.log(bookmarkObj[item.key].length, \"fhfjhfjhfk\");\r\n      return (\r\n        <li className=\"bookmark-page-item\" key={item.key}>\r\n          <img\r\n            className=\"bookmark-page-cover\"\r\n            src={coverObj[item.key]}\r\n            alt=\"\"\r\n          />\r\n          <p className=\"bookmark-page-name\">{bookArr[index].name}</p>\r\n\r\n          <ul className=\"bookmark-page-bookmark-container\">\r\n            {renderBookmarklistItem(item)}\r\n          </ul>\r\n        </li>\r\n      );\r\n    };\r\n    const renderBookmarkPage = () => {\r\n      return bookArr.map((item, index) => {\r\n        return (\r\n          <div key={index}>{renderBookmarkPageItem(item, index, false)}</div>\r\n        );\r\n      });\r\n    };\r\n    return (\r\n      <div className=\"bookmark-page-container\">{renderBookmarkPage()}</div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    state: state,\r\n    bookmarks: state.reader.bookmarks,\r\n    covers: state.manager.covers,\r\n    books: state.manager.books,\r\n    epubs: state.manager.epubs\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleFetchBookmarks,\r\n  handleReadingState,\r\n  handleReadingBook,\r\n  handleReadingEpub\r\n};\r\nBookmarkPage = connect(mapStateToProps, actionCreator)(BookmarkPage);\r\nexport default BookmarkPage;\r\n","import React, { Component } from \"react\";\r\nimport \"./noteList.css\";\r\nimport { connect } from \"react-redux\";\r\nclass NoteList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { currentDate: null, currentIndex: null };\r\n  }\r\n\r\n  handleBookName = bookKey => {\r\n    let { books } = this.props;\r\n    let chapter = \"\";\r\n    for (let i = 0; i < this.props.books.length; i++) {\r\n      console.log(books[i].key === bookKey);\r\n      if (books[i].key === bookKey) {\r\n        chapter = books[i].name;\r\n        break;\r\n      }\r\n    }\r\n    console.log(chapter, \"chapter\");\r\n    return chapter;\r\n  };\r\n  handleClick = (date, index) => {\r\n    if (this.state.currentDate) {\r\n      this.setState({ currentDate: null, currentIndex: null });\r\n    } else {\r\n      this.setState({ currentDate: date, currentIndex: index });\r\n    }\r\n  };\r\n  render() {\r\n    let { notes } = this.props;\r\n    console.log(this.props.notes);\r\n    let noteArr = [];\r\n    for (let i = notes.length - 1; i >= 0; i--) {\r\n      noteArr.push(notes[i]);\r\n    }\r\n\r\n    console.log(noteArr[0].date, notes, \"notesaghsag\");\r\n    let dateArr = [noteArr[0].date];\r\n    let temp = noteArr[0].date;\r\n    // console.log(noteArr[0].date.day === noteArr[1].date.day);\r\n    for (let i = 1; i < noteArr.length; i++) {\r\n      // console.log(noteArr[i].date);\r\n      console.log(noteArr[i].date);\r\n      if (\r\n        noteArr[i].date !== undefined &&\r\n        (noteArr[i].date.year !== temp.year ||\r\n          noteArr[i].date.month !== temp.month ||\r\n          noteArr[i].date.day !== temp.day)\r\n      ) {\r\n        dateArr.push(noteArr[i].date);\r\n        temp = noteArr[i].date;\r\n      }\r\n\r\n      // console.log(dateArr);\r\n    }\r\n    let noteObj = {};\r\n    console.log(dateArr);\r\n\r\n    dateArr.forEach(date => {\r\n      noteObj[\"\" + date.year + date.month + date.day] = [];\r\n    });\r\n    noteArr.forEach(note => {\r\n      dateArr.forEach(date => {\r\n        if (\r\n          date.year === note.date.year &&\r\n          date.month === note.date.month &&\r\n          date.day === note.date.day\r\n        ) {\r\n          noteObj[\"\" + date.year + date.month + date.day].push(note);\r\n        }\r\n      });\r\n      // if(item.date.year===)\r\n    });\r\n    console.log(noteObj, \"agasgbsg\");\r\n    const renderNoteListItem = date => {\r\n      return noteObj[date].map((item, index) => {\r\n        console.log(item, \"item\");\r\n        // console.log(height, \"height\");\r\n        // notePageItem.setAttribute(\"style\", `height:${height}px`);\r\n        let isCurrent =\r\n          this.state.currentDate === date && this.state.currentIndex === index;\r\n        return (\r\n          <li\r\n            className=\"note-list-item\"\r\n            key={index}\r\n            style={isCurrent ? { height: \"200px\" } : null}\r\n          >\r\n            <div className=\"note-list-item-note\">{item.notes}</div>\r\n            <div\r\n              onClick={() => {\r\n                this.handleClick(date, index);\r\n              }}\r\n            >\r\n              <div\r\n                className=\"note-list-item-show-more\"\r\n                style={\r\n                  isCurrent\r\n                    ? { color: \"rgba(75,75,75,0.8)\", bottom: \"10px\" }\r\n                    : {}\r\n                }\r\n              >\r\n                {isCurrent ? \"收起\" : \"显示笔记出处\"}\r\n              </div>\r\n              {isCurrent ? null : (\r\n                <span className=\"icon-dropdown note-list-show-more-icon\"></span>\r\n              )}\r\n            </div>\r\n            <div\r\n              className=\"note-list-item-more-info\"\r\n              style={isCurrent ? { display: \"block\" } : {}}\r\n            >\r\n              <div className=\"note-list-item-more-text\">{item.text}</div>\r\n              <div className=\"note-list-item-citation\">\r\n                <div className=\"note-list-item-title\">来自《</div>\r\n                <div className=\"note-list-item-chapter note-list-item-title\">\r\n                  {this.handleBookName(item.bookKey)}\r\n                </div>\r\n                <div className=\"note-list-item-title\">》{item.chapter}</div>\r\n              </div>\r\n            </div>\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n    const renderNoteList = () => {\r\n      return dateArr.map((item, index) => {\r\n        return (\r\n          <li className=\"note-page-item\" key={index}>\r\n            <div className=\"note-page-item-date\">{`${item.year}年${item.month}月${item.day}日`}</div>\r\n            <ul className=\"note-list-container-box\">\r\n              {renderNoteListItem(\"\" + item.year + item.month + item.day)}\r\n            </ul>\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n    console.log(dateArr, noteArr, notes, \"notesaghsag\");\r\n    return <div className=\"note-list-container\">{renderNoteList()}</div>;\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    notes: state.reader.notes,\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    bookmarks: state.reader.bookmarks,\r\n    chapters: state.reader.chapters,\r\n    books: state.manager.books\r\n  };\r\n};\r\nconst actionCreator = {\r\n  // handleFetchNotes\r\n};\r\nNoteList = connect(mapStateToProps, actionCreator)(NoteList);\r\nexport default NoteList;\r\n","import React, { Component } from \"react\";\r\nimport \"./digestList.css\";\r\nimport { connect } from \"react-redux\";\r\nclass DigestList extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n  }\r\n  handleBookName = bookKey => {\r\n    let { books } = this.props;\r\n    let chapter = \"\";\r\n    for (let i = 0; i < this.props.books.length; i++) {\r\n      console.log(books[i].key === bookKey, \"fhgjfhj\");\r\n      if (books[i].key === bookKey) {\r\n        chapter = books[i].name;\r\n        break;\r\n      }\r\n    }\r\n    console.log(books, chapter, bookKey, \"sasbfs\");\r\n    return chapter;\r\n  };\r\n  render() {\r\n    let { digests } = this.props;\r\n    console.log(this.props.digests);\r\n    let digestArr = [];\r\n    for (let i = digests.length - 1; i >= 0; i--) {\r\n      digestArr.push(digests[i]);\r\n    }\r\n\r\n    // console.log(digestArr[0].date, digests, \"digestsaghsag\");\r\n    let dateArr = [digestArr[0].date];\r\n    let temp = digestArr[0].date;\r\n    // console.log(digestArr[0].date.day === digestArr[1].date.day);\r\n    for (let i = 1; i < digestArr.length; i++) {\r\n      // console.log(digestArr[i].date);\r\n      if (\r\n        digestArr[i].date.year !== temp.year ||\r\n        digestArr[i].date.month !== temp.month ||\r\n        digestArr[i].date.day !== temp.day\r\n      ) {\r\n        dateArr.push(digestArr[i].date);\r\n        temp = digestArr[i].date;\r\n      }\r\n      // console.log(dateArr);\r\n    }\r\n    let digestObj = {};\r\n    dateArr.forEach(date => {\r\n      digestObj[\"\" + date.year + date.month + date.day] = [];\r\n    });\r\n    digestArr.forEach(digest => {\r\n      dateArr.forEach(date => {\r\n        if (\r\n          date.year === digest.date.year &&\r\n          date.month === digest.date.month &&\r\n          date.day === digest.date.day\r\n        ) {\r\n          digestObj[\"\" + date.year + date.month + date.day].push(digest);\r\n        }\r\n      });\r\n      // if(item.date.year===)\r\n    });\r\n    console.log(digestObj, \"agasgbsg\");\r\n    const renderDigestListItem = date => {\r\n      return digestObj[date].map((item, index) => {\r\n        return (\r\n          <li className=\"digest-list-item\" key={index}>\r\n            <div className=\"digest-list-item-digest\">\r\n              <div className=\"digest-list-item-text\">{item.text}</div>\r\n              <div className=\"digest-list-item-citation\">\r\n                <div className=\"digest-list-item-title\">来自《</div>\r\n                <div className=\"digest-list-item-chapter digest-list-item-title\">\r\n                  {this.handleBookName(item.bookKey)}\r\n                </div>\r\n                <div className=\"digest-list-item-title\">》{item.chapter}</div>\r\n              </div>\r\n            </div>\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n    const renderDigestList = () => {\r\n      return dateArr.map((item, index) => {\r\n        return (\r\n          <li className=\"digest-page-item\" key={index}>\r\n            <div className=\"digest-page-item-date\">{`${item.year}年${item.month}月${item.day}日`}</div>\r\n            <ul className=\"digest-list-container-box\">\r\n              {renderDigestListItem(\"\" + item.year + item.month + item.day)}\r\n            </ul>\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n    console.log(dateArr, digestArr, digests, \"digestsaghsag\");\r\n    return <div className=\"digest-list-container\">{renderDigestList()}</div>;\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    digests: state.reader.digests,\r\n    currentEpub: state.book.currentEpub,\r\n    currentBook: state.book.currentBook,\r\n    bookmarks: state.reader.bookmarks,\r\n    chapters: state.reader.chapters,\r\n    books: state.manager.books\r\n  };\r\n};\r\nconst actionCreator = {};\r\nDigestList = connect(mapStateToProps, actionCreator)(DigestList);\r\nexport default DigestList;\r\n","// import localforage from \"localforage\";\r\nclass DeleteUtil {\r\n  static deleteBook(books, bookKey) {\r\n    let deleteIndex;\r\n    // console.log(books);\r\n    for (let i = 0; i < books.length; i++) {\r\n      if (books[i].key === bookKey) {\r\n        deleteIndex = i;\r\n        break;\r\n      }\r\n    }\r\n    // console.log(books);\r\n    books.splice(deleteIndex, 1);\r\n    return books;\r\n  }\r\n  static deleteBookmarks(bookmarks, bookKey) {\r\n    let deleteIndex = [];\r\n    console.log(bookmarks);\r\n    for (let i = 0; i < bookmarks.length; i++) {\r\n      console.log(bookmarks[i].bookKey, bookKey);\r\n      if (bookmarks[i].bookKey === bookKey) {\r\n        deleteIndex.push(i);\r\n      }\r\n    }\r\n    console.log(deleteIndex);\r\n    deleteIndex.forEach(item => {\r\n      bookmarks.splice(item, 1);\r\n    });\r\n    return bookmarks;\r\n  }\r\n  static deleteNotes(notes, bookKey) {\r\n    let deleteIndex = [];\r\n    // console.log(bookmarks);\r\n    for (let i = 0; i < notes.length; i++) {\r\n      if (notes[i].bookKey === bookKey) {\r\n        deleteIndex.push(i);\r\n      }\r\n    }\r\n    deleteIndex.forEach(item => {\r\n      notes.splice(item, 1);\r\n    });\r\n    return notes;\r\n  }\r\n  static deleteDigests(digests, bookKey) {\r\n    let deleteIndex = [];\r\n    console.log(\"ahhadhg\");\r\n    console.log(digests);\r\n    if (digests !== undefined) {\r\n      for (let i = 0; i < digests.length; i++) {\r\n        if (digests[i].bookKey === bookKey) {\r\n          deleteIndex.push(i);\r\n        }\r\n      }\r\n      deleteIndex.forEach(item => {\r\n        digests.splice(item, 1);\r\n      });\r\n    }\r\n\r\n    return digests;\r\n  }\r\n  static deleteHighlighters(highlighters, bookKey) {\r\n    let deleteIndex = [];\r\n    // console.log(bookmarks);\r\n    for (let i = 0; i < highlighters.length; i++) {\r\n      if (highlighters[i].bookKey === bookKey) {\r\n        deleteIndex.push(i);\r\n      }\r\n    }\r\n    deleteIndex.forEach(item => {\r\n      highlighters.splice(item, 1);\r\n    });\r\n    return highlighters;\r\n  }\r\n}\r\n\r\nexport default DeleteUtil;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport \"./deleteDialog.css\";\r\nimport {\r\n  handleFetchBooks,\r\n  handleMessageBox,\r\n  handleMessage\r\n} from \"../../redux/manager.redux\";\r\nimport { handleDeleteDialog } from \"../../redux/book.redux\";\r\nimport {\r\n  handleFetchBookmarks,\r\n  handleFetchNotes,\r\n  handleFetchDigests,\r\n  handleFetchHighlighters\r\n} from \"../../redux/reader.redux\";\r\nimport DeleteUtil from \"../../utils/deleteUtil\";\r\nimport localforage from \"localforage\";\r\nclass DeleteDialog extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isCheck: false };\r\n  }\r\n  handleCancel = () => {\r\n    this.props.handleDeleteDialog(false);\r\n  };\r\n  handleComfirm = () => {\r\n    this.props.books !== null &&\r\n      localforage\r\n        .setItem(\r\n          \"books\",\r\n          DeleteUtil.deleteBook(this.props.books, this.props.currentBook.key)\r\n        )\r\n        .then(() => {\r\n          this.props.handleDeleteDialog(false);\r\n          this.props.handleFetchBooks();\r\n        });\r\n    console.log(this.props.bookmarks, \"bookmarks\");\r\n    if (this.state.isCheck) {\r\n      this.props.bookmarks !== null &&\r\n        localforage\r\n          .setItem(\r\n            \"bookmarks\",\r\n            DeleteUtil.deleteBookmarks(\r\n              this.props.bookmarks,\r\n              this.props.currentBook.key\r\n            )\r\n          )\r\n          .then(() => {\r\n            this.props.handleFetchBookmarks();\r\n          });\r\n      console.log(this.props.notes, \"notes\");\r\n\r\n      this.props.notes !== null &&\r\n        localforage\r\n          .setItem(\r\n            \"notes\",\r\n            DeleteUtil.deleteNotes(this.props.notes, this.props.currentBook.key)\r\n          )\r\n          .then(() => {\r\n            this.props.handleFetchNotes();\r\n          });\r\n      console.log(this.props.digests, \"digests\");\r\n      this.props.digests !== null &&\r\n        localforage\r\n          .setItem(\r\n            \"digests\",\r\n            DeleteUtil.deleteDigests(\r\n              this.props.digests,\r\n              this.props.currentBook.key\r\n            )\r\n          )\r\n          .then(() => {\r\n            this.props.handleFetchDigests();\r\n          });\r\n      // console.log(this.props.highlighters, \"highlighters\");\r\n      this.props.highlighters !== null &&\r\n        localforage\r\n          .setItem(\r\n            \"highlighters\",\r\n            DeleteUtil.deleteHighlighters(\r\n              this.props.highlighters,\r\n              this.props.currentBook.key\r\n            )\r\n          )\r\n          .then(() => {\r\n            this.props.handleFetchHighlighters();\r\n          });\r\n    }\r\n    this.props.handleMessage(\"删除成功\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  handleCheck = mode => {\r\n    this.setState({ isCheck: mode });\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"delete-dialog-container\">\r\n        <div className=\"delete-dialog-title\">是否删除本图书</div>\r\n        <div className=\"delete-dialog-book\">\r\n          <div className=\"delete-dialog-book-title\">\r\n            {this.props.currentBook.name}\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"delete-dialog-other-option\">\r\n          同时删除本书所有的书签，笔记，书摘\r\n        </div>\r\n        {this.state.isCheck ? (\r\n          <span\r\n            className=\"icon-check\"\r\n            onClick={() => {\r\n              this.handleCheck(false);\r\n            }}\r\n          ></span>\r\n        ) : (\r\n          <span\r\n            className=\"delete-dialog-uncheck-icon\"\r\n            onClick={() => {\r\n              this.handleCheck(true);\r\n            }}\r\n          ></span>\r\n        )}\r\n        <div\r\n          className=\"delete-dialog-cancel\"\r\n          onClick={() => {\r\n            this.handleCancel();\r\n          }}\r\n        >\r\n          取消\r\n        </div>\r\n        <div\r\n          className=\"delete-dialog-comfirm\"\r\n          onClick={() => {\r\n            this.handleComfirm();\r\n          }}\r\n        >\r\n          删除\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books,\r\n    isOpenDeleteDialog: state.book.isOpenDeleteDialog,\r\n    currentBook: state.book.currentBook,\r\n    bookmarks: state.reader.bookmarks,\r\n    notes: state.reader.notes,\r\n    digests: state.reader.digests,\r\n    highlighters: state.reader.highlighters\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleFetchBooks,\r\n  handleDeleteDialog,\r\n  handleFetchBookmarks,\r\n  handleFetchNotes,\r\n  handleFetchDigests,\r\n  handleFetchHighlighters,\r\n  handleMessageBox,\r\n  handleMessage\r\n};\r\nDeleteDialog = connect(mapStateToProps, actionCreator)(DeleteDialog);\r\nexport default DeleteDialog;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport \"./editDialog.css\";\r\nimport {\r\n  handleFetchBooks,\r\n  handleMessageBox,\r\n  handleMessage\r\n} from \"../../redux/manager.redux\";\r\nimport { handleEditDialog } from \"../../redux/book.redux\";\r\nimport localforage from \"localforage\";\r\nclass editDialog extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isCheck: false };\r\n  }\r\n  componentDidMount() {\r\n    let nameBox = document.querySelector(\".edit-dialog-book-name-box\");\r\n    let authorBox = document.querySelector(\".edit-dialog-book-author-box\");\r\n    console.log(this.props.currentBook);\r\n    nameBox.value = this.props.currentBook.name;\r\n    authorBox.value = this.props.currentBook.author;\r\n  }\r\n\r\n  handleCancel = () => {\r\n    this.props.handleEditDialog(false);\r\n  };\r\n  handleComfirm = () => {\r\n    let name = document.querySelector(\".edit-dialog-book-name-box\").value;\r\n    let author = document.querySelector(\".edit-dialog-book-author-box\").value;\r\n    let { books } = this.props;\r\n    books.forEach(item => {\r\n      if (item.key === this.props.currentBook.key) {\r\n        item.name = name;\r\n        item.author = author;\r\n        return false;\r\n      }\r\n    });\r\n    localforage.setItem(\"books\", books).then(() => {\r\n      this.props.handleEditDialog(false);\r\n      this.props.handleFetchBooks();\r\n    });\r\n    this.props.handleMessage(\"编辑成功\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  render() {\r\n    return (\r\n      <div className=\"edit-dialog-container\">\r\n        <div className=\"edit-dialog-title\">编辑图书</div>\r\n        <div className=\"edit-dialog-book-name-container\">\r\n          <div className=\"edit-dialog-book-name-text\">书名</div>\r\n          <input className=\"edit-dialog-book-name-box\" />\r\n        </div>\r\n        <div className=\"edit-dialog-book-author-container\">\r\n          <div className=\"edit-dialog-book-author-text\">作者</div>\r\n          <input className=\"edit-dialog-book-author-box\" />\r\n        </div>\r\n        <div\r\n          className=\"edit-dialog-cancel\"\r\n          onClick={() => {\r\n            this.handleCancel();\r\n          }}\r\n        >\r\n          取消\r\n        </div>\r\n        <div\r\n          className=\"edit-dialog-comfirm\"\r\n          onClick={() => {\r\n            this.handleComfirm();\r\n          }}\r\n        >\r\n          确认\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books,\r\n    isOpenDeleteDialog: state.book.isOpenDeleteDialog,\r\n    currentBook: state.book.currentBook,\r\n    bookmarks: state.reader.bookmarks,\r\n    notes: state.reader.notes,\r\n    digests: state.reader.digests,\r\n    highlighters: state.reader.highlighters\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleFetchBooks,\r\n  handleEditDialog,\r\n  handleMessageBox,\r\n  handleMessage\r\n};\r\neditDialog = connect(mapStateToProps, actionCreator)(editDialog);\r\nexport default editDialog;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport \"./addDialog.css\";\r\nimport { handleMessageBox, handleMessage } from \"../../redux/manager.redux\";\r\nimport { handleAddDialog } from \"../../redux/book.redux\";\r\nimport ShelfUtil from \"../../utils/shelfUtil\";\r\n\r\nclass AddDialog extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { isNew: false };\r\n  }\r\n\r\n  handleCancel = () => {\r\n    this.props.handleAddDialog(false);\r\n  };\r\n  handleComfirm = () => {\r\n    let shelfTitle = document.querySelector(\".add-dialog-shelf-list-box\").value;\r\n    if (this.state.isNew) {\r\n      shelfTitle = document.querySelector(\".add-dialog-new-shelf-box\").value;\r\n    }\r\n    ShelfUtil.setShelf(shelfTitle, this.props.currentBook.key);\r\n    this.props.handleAddDialog(false);\r\n    this.props.handleMessage(\"添加成功\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  handleChange = event => {\r\n    let shelfTitle = event.target.value;\r\n    if (shelfTitle === \"新建书架\") {\r\n      this.setState({ isNew: true });\r\n      document\r\n        .querySelector(\".add-dialog-new-shelf-box\")\r\n        .removeAttribute(\"disabled\");\r\n    } else {\r\n      this.setState({ isNew: false });\r\n      document\r\n        .querySelector(\".add-dialog-new-shelf-box\")\r\n        .setAttribute(\"disabled\", \"diabled\");\r\n    }\r\n\r\n    console.log(shelfTitle, this.state.isNew);\r\n  };\r\n  render() {\r\n    const renderShelfList = () => {\r\n      let shelfList = ShelfUtil.getShelf();\r\n      let shelfTitle = Object.keys(shelfList);\r\n      console.log(shelfTitle);\r\n      return shelfTitle.map((item, index) => {\r\n        return (\r\n          <option\r\n            value={item}\r\n            key={index}\r\n            className=\"add-dialog-shelf-list-option\"\r\n          >\r\n            {item}\r\n          </option>\r\n        );\r\n      });\r\n    };\r\n    return (\r\n      <div className=\"add-dialog-container\">\r\n        <div className=\"add-dialog-title\">添加到书架</div>\r\n        <div className=\"add-dialog-shelf-list-container\">\r\n          <div className=\"add-dialog-shelf-list-text\">选择</div>\r\n          <select\r\n            className=\"add-dialog-shelf-list-box\"\r\n            onChange={event => {\r\n              this.handleChange(event);\r\n            }}\r\n          >\r\n            {renderShelfList()}\r\n          </select>\r\n        </div>\r\n        <div className=\"add-dialog-new-shelf-container\">\r\n          <div className=\"add-dialog-new-shelf-text\">新建</div>\r\n          <input className=\"add-dialog-new-shelf-box\" disabled />\r\n        </div>\r\n        <div\r\n          className=\"add-dialog-cancel\"\r\n          onClick={() => {\r\n            this.handleCancel();\r\n          }}\r\n        >\r\n          取消\r\n        </div>\r\n        <div\r\n          className=\"add-dialog-comfirm\"\r\n          onClick={() => {\r\n            this.handleComfirm();\r\n          }}\r\n        >\r\n          确认\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books,\r\n    isOpenDeleteDialog: state.book.isOpenDeleteDialog,\r\n    currentBook: state.book.currentBook,\r\n    bookmarks: state.reader.bookmarks,\r\n    notes: state.reader.notes,\r\n    digests: state.reader.digests,\r\n    highlighters: state.reader.highlighters\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleAddDialog,\r\n  handleMessageBox,\r\n  handleMessage\r\n};\r\nAddDialog = connect(mapStateToProps, actionCreator)(AddDialog);\r\nexport default AddDialog;\r\n","import React, { Component } from \"react\";\r\nimport \"./sortDialog.css\";\r\nimport { connect } from \"react-redux\";\r\nimport OtherUtil from \"../../utils/otherUtil\";\r\nimport { handleSort, handleSortCode } from \"../../redux/manager.redux\";\r\nclass SortDialog extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      isSort: this.props.isSort,\r\n      sortCode: this.props.sortCode\r\n    };\r\n  }\r\n  UNSAFE_componentWillReceiveProps = nextProps => {\r\n    this.setState({\r\n      isSort: nextProps.isSort,\r\n      sortCode: nextProps.sortCode\r\n    });\r\n  };\r\n  handleSort = code => {\r\n    let sortCode = this.state.sortCode;\r\n    sortCode.sort = code;\r\n    console.log(sortCode);\r\n    this.setState({ sortCode });\r\n    this.props.handleSortCode(sortCode);\r\n    console.log(this.props.sortCode);\r\n    OtherUtil.setSortCode(code, this.state.sortCode.order);\r\n  };\r\n  handleOrder = code => {\r\n    let sortCode = this.state.sortCode;\r\n    sortCode.order = code;\r\n    this.setState({ sortCode });\r\n    OtherUtil.setSortCode(this.state.sortCode.sort, code);\r\n    this.props.handleSortCode(sortCode);\r\n    console.log(this.props.sortCode);\r\n  };\r\n  render() {\r\n    console.log(this.state.sortCode);\r\n    return (\r\n      <div className=\"sort-dialog-container\">\r\n        <ul className=\"sort-by-category\">\r\n          <li\r\n            className=\"sort-by-category-list\"\r\n            onClick={() => {\r\n              this.handleSort(1);\r\n            }}\r\n            style={\r\n              this.state.sortCode.sort === 1\r\n                ? { color: \"rgba(75, 75, 75, 1)\" }\r\n                : {}\r\n            }\r\n          >\r\n            按名称\r\n          </li>\r\n          <li\r\n            className=\"sort-by-category-list\"\r\n            onClick={() => {\r\n              this.handleSort(2);\r\n            }}\r\n            style={\r\n              this.state.sortCode.sort === 2\r\n                ? { color: \"rgba(75, 75, 75, 1)\" }\r\n                : {}\r\n            }\r\n          >\r\n            按添加时间\r\n          </li>\r\n        </ul>\r\n        <div className=\"sort-dialog-seperator\"></div>\r\n        <ul className=\"sort-by-order\">\r\n          <li\r\n            className=\"sort-by-order-list\"\r\n            onClick={() => {\r\n              this.handleOrder(1);\r\n            }}\r\n            style={\r\n              this.state.sortCode.order === 1\r\n                ? { color: \"rgba(75, 75, 75, 1)\" }\r\n                : {}\r\n            }\r\n          >\r\n            顺序\r\n          </li>\r\n          <li\r\n            className=\"sort-by-order-list\"\r\n            onClick={() => {\r\n              this.handleOrder(2);\r\n            }}\r\n            style={\r\n              this.state.sortCode.order === 2\r\n                ? { color: \"rgba(75, 75, 75, 1)\" }\r\n                : {}\r\n            }\r\n          >\r\n            逆序\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { sortCode: state.manager.sortCode };\r\n};\r\nconst actionCreator = {\r\n  handleSort,\r\n  handleSortCode\r\n};\r\nSortDialog = connect(mapStateToProps, actionCreator)(SortDialog);\r\nexport default SortDialog;\r\n","import React, { Component } from \"react\";\r\nimport \"./loadingPage.css\";\r\nimport { connect } from \"react-redux\";\r\nclass LoadingPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n  }\r\n\r\n  render() {\r\n    const renderLoadingPage = () => {\r\n      let arr = [];\r\n      for (let i = 0; i < localStorage.getItem(\"totalBooks\"); i++) {\r\n        arr.push({});\r\n      }\r\n      return arr.map((item, index) => {\r\n        return (\r\n          <div className=\"loading-page-book\" key={index}>\r\n            <div\r\n              className=\"loading-page-cover\"\r\n              style={{ opacity: `${(index % 7) * 0.2 + 0.2}` }}\r\n            ></div>\r\n          </div>\r\n        );\r\n      });\r\n    };\r\n    return <div className=\"loading-page-container\">{renderLoadingPage()}</div>;\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books\r\n  };\r\n};\r\nconst actionCreator = {};\r\nLoadingPage = connect(mapStateToProps, actionCreator)(LoadingPage);\r\nexport default LoadingPage;\r\n","import React, { Component } from \"react\";\r\nimport \"./chooseDrive.css\";\r\nimport { driveList } from \"../../utils/readerConfig\";\r\nimport { handleChoose } from \"../../redux/chooseDrive.redux\";\r\nimport { connect } from \"react-redux\";\r\nimport { handleMessageBox, handleMessage } from \"../../redux/manager.redux\";\r\nclass ChooseDrive extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n  }\r\n  handleClose = () => {\r\n    this.props.handleChoose(false);\r\n  };\r\n  handleChoose = () => {\r\n    this.props.handleMessage(\"下载客户端体验完整功能\");\r\n    this.props.handleMessageBox(true);\r\n  };\r\n  render() {\r\n    const renderDrivePage = () => {\r\n      return driveList.map((item, index) => {\r\n        return (\r\n          <li\r\n            key={item.id}\r\n            className=\"choose-drive-list-item\"\r\n            onClick={() => {\r\n              this.handleChoose(item.icon, index);\r\n            }}\r\n          >\r\n            <div className=\"choose-drive-list-item-container\">\r\n              <span\r\n                className={`icon-${item.icon} choose-drive-list-icon`}\r\n              ></span>\r\n              <div className=\"choose-drive-list-title\">{item.name}</div>\r\n            </div>\r\n          </li>\r\n        );\r\n      });\r\n    };\r\n\r\n    return (\r\n      <div className=\"choose-drive-container\">\r\n        <div className=\"choose-drive-title\">绑定您的网盘账号</div>\r\n        <span\r\n          className=\"icon-close choose-drive-close-icon\"\r\n          onClick={() => {\r\n            this.handleClose();\r\n          }}\r\n        ></span>\r\n        <div className=\"choose-drive-drive-container\">\r\n          <div>{renderDrivePage()}</div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {};\r\n};\r\nconst actionCreator = {\r\n  handleChoose,\r\n  handleMessageBox,\r\n  handleMessage\r\n};\r\nChooseDrive = connect(mapStateToProps, actionCreator)(ChooseDrive);\r\nexport default ChooseDrive;\r\n","import React, { Component } from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport \"./emptyPage.css\";\r\nimport { emptyList } from \"../../utils/readerConfig\";\r\nclass EmptyPage extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = { mode: this.props.mode };\r\n  }\r\n  UNSAFE_componentWillReceiveProps = nextProps => {\r\n    // console.log(nextProps);\r\n    this.setState({\r\n      mode: nextProps.mode\r\n    });\r\n  };\r\n  render() {\r\n    const renderEmptyList = () => {\r\n      return emptyList.map(item => {\r\n        return (\r\n          <div\r\n            className=\"empty-page-info-container\"\r\n            key={item.mode}\r\n            style={\r\n              this.state.mode === item.mode ? {} : { visibility: \"hidden\" }\r\n            }\r\n          >\r\n            <div className=\"empty-page-info-main\">{item.main}</div>\r\n            <div className=\"empty-page-info-sub\">{item.sub}</div>\r\n          </div>\r\n        );\r\n      });\r\n    };\r\n    return (\r\n      <div className=\"empty-page-container\">\r\n        <img\r\n          src=\"../../assets/empty.jpg\"\r\n          alt=\"\"\r\n          className=\"empty-page-illustration\"\r\n        />\r\n        {renderEmptyList()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    mode: state.sidebar.mode\r\n  };\r\n};\r\nconst actionCreator = {};\r\nEmptyPage = connect(mapStateToProps, actionCreator)(EmptyPage);\r\nexport default EmptyPage;\r\n","import React, { Component } from \"react\";\r\nimport Sidebar from \"../../components/sidebar/sidebar\";\r\nimport Header from \"../../components/header/header\";\r\nimport BookList from \"../../components/bookList/booklist\";\r\nimport BookmarkPage from \"../../components/bookmarkPage/bookmarkPage\";\r\nimport NoteList from \"../../components/noteList/noteList\";\r\nimport DigestList from \"../../components/digestList/digestList\";\r\nimport DeleteDialog from \"../../components/deleteDialog/deleteDialog\";\r\nimport EditDialog from \"../../components/editDialog/editDialog\";\r\nimport AddDialog from \"../../components/addDialog/addDialog\";\r\nimport SortDialog from \"../../components/sortDialog/sortDialog\";\r\nimport MessageBox from \"../../components/messageBox/messageBox\";\r\nimport LoadingPage from \"../../components/loadingPage/loadingPage\";\r\nimport ChooseDrive from \"../../components/chooseDrive/chooseDrive\";\r\nimport EmptyPage from \"../../components/emptyPage/emptyPage\";\r\nimport { connect } from \"react-redux\";\r\nimport {\r\n  handleFetchBooks,\r\n  handleFetchSortCode,\r\n  handleFetchList,\r\n  handleList,\r\n  handleMessageBox\r\n} from \"../../redux/manager.redux\";\r\nimport {\r\n  handleFetchNotes,\r\n  handleFetchDigests,\r\n  handleFetchBookmarks,\r\n  handleFetchHighlighters\r\n} from \"../../redux/reader.redux\";\r\nimport \"./manager.css\";\r\n\r\nclass Manager extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      mode: this.props.mode,\r\n      shelfIndex: this.props.shelfIndex,\r\n      books: this.props.books,\r\n      notes: this.props.notes,\r\n      digests: this.props.digests,\r\n      covers: this.props.covers,\r\n      bookmarks: this.props.bookmarks,\r\n      isOpenEditDialog: this.props.isOpenEditDialog,\r\n      isOpenDeleteDialog: this.props.isOpenDeleteDialog,\r\n      isOpenAddDialog: this.props.isOpenAddDialog,\r\n      isSort: this.props.isSort,\r\n      isSortDisplay: this.props.isSortDisplay,\r\n      isMessage: false,\r\n      isChoose: false,\r\n      totalBooks: localStorage.getItem(\"totalBooks\") || 0\r\n    };\r\n  }\r\n  //从indexdb里读取书籍\r\n  UNSAFE_componentWillMount() {\r\n    this.props.handleFetchBooks();\r\n    this.props.handleFetchNotes();\r\n    this.props.handleFetchDigests();\r\n    this.props.handleFetchBookmarks();\r\n    this.props.handleFetchHighlighters();\r\n    this.props.handleFetchSortCode();\r\n    this.props.handleList(localStorage.getItem(\"isList\") || false);\r\n  }\r\n\r\n  UNSAFE_componentWillReceiveProps(nextProps) {\r\n    // console.log(nextProps);\r\n    this.setState({\r\n      mode: nextProps.mode,\r\n      shelfIndex: nextProps.shelfIndex,\r\n      books: nextProps.books,\r\n      notes: nextProps.notes,\r\n      covers: nextProps.covers,\r\n      digests: nextProps.digests,\r\n      bookmarks: nextProps.bookmarks,\r\n      isOpenDeleteDialog: nextProps.isOpenDeleteDialog,\r\n      isOpenEditDialog: nextProps.isOpenEditDialog,\r\n      isOpenAddDialog: nextProps.isOpenAddDialog,\r\n      isSort: nextProps.isSort,\r\n      isSortDisplay: nextProps.isSortDisplay,\r\n      isMessage: nextProps.isMessage,\r\n      isChoose: nextProps.isChoose\r\n    });\r\n    console.log(this.state.books, \"books\");\r\n    this.setState({\r\n      totalBooks: this.state.books === null ? 0 : this.state.books.length\r\n    });\r\n    localStorage.setItem(\"totalBooks\", this.state.totalBooks);\r\n\r\n    if (nextProps.isMessage) {\r\n      setTimeout(() => {\r\n        this.props.handleMessageBox(false);\r\n        this.setState({ isMessage: false });\r\n      }, 2000);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let { mode, notes, digests, bookmarks, covers, totalBooks } = this.state;\r\n    console.log(this.state.totalBooks, \"toatl\");\r\n    // console.log(this.state.isMessage, \"message\");\r\n    return (\r\n      <div className=\"manager\">\r\n        <Sidebar />\r\n        <Header />\r\n        <div className=\"manager-dialog-container\">\r\n          {this.state.isOpenDeleteDialog ? (\r\n            <DeleteDialog />\r\n          ) : this.state.isOpenEditDialog ? (\r\n            <EditDialog />\r\n          ) : this.state.isOpenAddDialog ? (\r\n            <AddDialog />\r\n          ) : null}\r\n        </div>\r\n        {this.state.isMessage ? <MessageBox /> : null}\r\n        {this.state.isSortDisplay ? <SortDialog /> : null}\r\n        {this.state.isChoose ? <ChooseDrive /> : null}\r\n        {totalBooks === 0 ? (\r\n          <EmptyPage />\r\n        ) : covers === null ? (\r\n          <LoadingPage />\r\n        ) : mode === \"home\" || mode === \"recent\" || mode === \"shelf\" ? (\r\n          <BookList />\r\n        ) : bookmarks !== null && mode === \"bookmark\" ? (\r\n          <BookmarkPage />\r\n        ) : notes !== null && notes !== undefined && mode === \"note\" ? (\r\n          <NoteList />\r\n        ) : digests !== null && mode === \"digest\" ? (\r\n          <DigestList />\r\n        ) : (\r\n          <LoadingPage />\r\n        )}\r\n      </div>\r\n    );\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return {\r\n    books: state.manager.books,\r\n    covers: state.manager.covers,\r\n    notes: state.reader.notes,\r\n    digests: state.reader.digests,\r\n    bookmarks: state.reader.bookmarks,\r\n    isReading: state.book.isReading,\r\n    mode: state.sidebar.mode,\r\n    shelfIndex: state.sidebar.shelfIndex,\r\n    isOpenEditDialog: state.book.isOpenEditDialog,\r\n    isOpenDeleteDialog: state.book.isOpenDeleteDialog,\r\n    isOpenAddDialog: state.book.isOpenAddDialog,\r\n    isSort: state.manager.isSort,\r\n    isSortDisplay: state.manager.isSortDisplay,\r\n    isMessage: state.manager.isMessage,\r\n    isChoose: state.chooseDrive.isChoose\r\n  };\r\n};\r\nconst actionCreator = {\r\n  handleFetchBooks,\r\n  handleFetchNotes,\r\n  handleFetchDigests,\r\n  handleFetchBookmarks,\r\n  handleFetchHighlighters,\r\n  handleFetchSortCode,\r\n  handleFetchList,\r\n  handleList,\r\n  handleMessageBox\r\n};\r\nManager = connect(mapStateToProps, actionCreator)(Manager);\r\nexport default Manager;\r\n","import React, { Component } from \"react\";\r\nimport Reader from \"./containers/reader/reader\";\r\nimport Manager from \"./containers/manager/manager\";\r\nimport \"./assets/styles/reset.css\";\r\nimport \"./assets/styles/style.css\";\r\nimport { connect } from \"react-redux\";\r\n// @connect(state => state.book)\r\nclass App extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {};\r\n  }\r\n  render() {\r\n    return this.props.isReading ? <Reader /> : <Manager />;\r\n  }\r\n}\r\nconst mapStateToProps = state => {\r\n  return { isReading: state.book.isReading };\r\n};\r\nconst actionCreator = {};\r\nApp = connect(mapStateToProps, actionCreator)(App);\r\nexport default App;\r\n","import readerConfig from \"../utils/readerConfig\";\r\nconst config = readerConfig.get();\r\nconst initState = {\r\n  fontSize: config.fontSize, // 0 代表使用默认值\r\n  theme: config.theme, //代表使用默认值\r\n  fontFamily: config.fontFamily, //代表默认使用思源黑体\r\n  fontWeight: config.fontWeight, //代表使用默认值\r\n  lineHeight: config.lineHeight, // 0 代表使用默认值\r\n  letterSpacing: config.letterSpacing, // 0 代表使用默认值\r\n  wordSpacing: config.wordSpacing, // 0 代表使用默认值\r\n  column: config.column, // 可取值为1, 2\r\n  padding: config.padding // 阅读区域与浏览器可视区域上下的间距\r\n};\r\nexport function settingPanel(state = initState, action) {\r\n  switch (action.type) {\r\n    case \"CHANGE_FONT_SIZE\":\r\n      return {\r\n        ...state,\r\n        fontSize: action.payload\r\n      };\r\n    case \"CHANGE_BACKGROUND\":\r\n      return {\r\n        ...state,\r\n        background: action.payload\r\n      };\r\n    case \"CHANGE_FONT\":\r\n      return {\r\n        ...state,\r\n        fontFamily: action.payload\r\n      };\r\n    case \"CHANGE_FONT_WEIGHT\":\r\n      return {\r\n        ...state,\r\n        fontWeight: action.payload\r\n      };\r\n    case \"CHANGE_LINE_HEIGHT\":\r\n      return {\r\n        ...state,\r\n        lineHeight: action.payload\r\n      };\r\n    case \"CHANGE_PADDING\":\r\n      return {\r\n        ...state,\r\n        padding: action.payload\r\n      };\r\n    case \"CHANGE_WORD_SPACING\":\r\n      return {\r\n        ...state,\r\n        wordSpacing: action.payload\r\n      };\r\n    case \"CHANGE_COLUMN\":\r\n      return {\r\n        ...state,\r\n        column: action.payload\r\n      };\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport function changeFontSize(fontSize) {\r\n  return { type: \"CHANGE_FONT_SIZE\", payload: fontSize };\r\n}\r\nexport function changeBackground(background) {\r\n  return { type: \"CHANGE_BACKGROUND\", payload: background };\r\n}\r\nexport function changeFont(fontFamily) {\r\n  return { type: \"CHANGE_FONT\", payload: fontFamily };\r\n}\r\nexport function changeFontWeight(fontWeight) {\r\n  return { type: \"CHANGE_FONT_WEIGHT\", payload: fontWeight };\r\n}\r\nexport function changeLineHeight(lineHeight) {\r\n  return { type: \"CHANGE_LINE_HEIGHT\", payload: lineHeight };\r\n}\r\nexport function changePadding(padding) {\r\n  return { type: \"CHANGE_PADDING\", payload: padding };\r\n}\r\nexport function changeWordSpacing(wordSpacing) {\r\n  return { type: \"CHANGE_WORD_SPACING\", payload: wordSpacing };\r\n}\r\nexport function changeColumn(column) {\r\n  return { type: \"CHANGE_COLUMN\", payload: column };\r\n}\r\n","import { createStore, applyMiddleware, compose, combineReducers } from \"redux\";\r\nimport thunk from \"redux-thunk\";\r\nimport { settingPanel } from \"./redux/settingPanel.redux\";\r\nimport { book } from \"./redux/book.redux\";\r\nimport { manager } from \"./redux/manager.redux\";\r\nimport { progressPanel } from \"./redux/progressPanel.redux\";\r\nimport { reader } from \"./redux/reader.redux\";\r\nimport { viewArea } from \"./redux/viewArea.redux\";\r\nimport { sidebar } from \"./redux/sidebar.redux\";\r\nimport {chooseDrive} from './redux/chooseDrive.redux'\r\nconst rootReducer = combineReducers({\r\n  settingPanel,\r\n  book,\r\n  manager,\r\n  reader,\r\n  progressPanel,\r\n  viewArea,\r\n  sidebar,\r\n  chooseDrive\r\n});\r\n// console.log(manager, rootReducer);\r\nconst store = createStore(\r\n  rootReducer,\r\n  compose(\r\n    applyMiddleware(thunk),\r\n    window.devToolsExtension ? window.devToolsExtension() : f => f\r\n  )\r\n);\r\nexport default store;\r\n","import React from \"react\";\r\nimport ReactDOM from \"react-dom\";\r\nimport App from \"./App\";\r\nimport { Provider } from \"react-redux\";\r\nimport store from \"./store\";\r\n// console.log(window.devToolsExtension, \"hello1\");\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <App />\r\n  </Provider>,\r\n  document.getElementById(\"root\")\r\n);\r\n"],"sourceRoot":""}